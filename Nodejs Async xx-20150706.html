<!DOCTYPE html>
<html lang="zh">
  <head>

      <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Title -->
      
      <title>Nodejs Async 学习 | 荆文征</title>

    <!-- Required Meta Tags Always Come First -->
    <meta charset="utf-8">
    <meta name="referrer" content="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="baidu-site-verification" content="x3N9zxqrty" />
    <meta name="baidu-site-verification" content="cP2u6szylS" />
    <meta name="google-site-verification" content="pwQ78Z9AmtXiVWejypS4rBSfBZ4_G95mchbkWo3EWmI" />
    
      <meta name="keywords" content="荆文征,MSITER,msiter,jingwenzheng,IOS,Blog,博客,荆文征博客,Nodejs,JAVA,JavaScript,js,swift,oc,objective-c,c++,c">
    
    
      <meta name="author" content="小酒馆老板">
    
    
      <meta name="description" content="欲买桂花同载酒&lt;br/&gt;终不似 少年游">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico">

    <!-- Google Fonts -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto+Slab:300,400,700%7COpen+Sans:400,600,700">

    <!-- CSS Global Compulsory -->
    <link rel="stylesheet" href="/assets/vendor/bootstrap/bootstrap.min.css">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="/assets/vendor/icon-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/vendor/icon-line-pro/style.css">
    <link rel="stylesheet" href="/assets/vendor/icon-hs/style.css">
    <link rel="stylesheet" href="/assets/vendor/animate.css">
    <link rel="stylesheet" href="/assets/vendor/hs-megamenu/src/hs.megamenu.css">
    <link rel="stylesheet" href="/assets/vendor/hamburgers/hamburgers.min.css">
    <link rel="stylesheet" href="/assets/vendor/slick-carousel/slick/slick.css">
    <link rel="stylesheet" href="/assets/vendor/fancybox/jquery.fancybox.css">

    <!-- Revolution Slider -->
    <link rel="stylesheet" href="/assets/vendor/revolution-slider/revolution/fonts/pe-icon-7-stroke/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="/assets/vendor/revolution-slider/revolution/css/settings.css">
    <link rel="stylesheet" href="/revolution-slider/carousel-gallery/assets/css/style.css">

    <!-- CSS Unify Theme -->
    <link rel="stylesheet" href="/assets/css/styles.bm-classic.css">

    <!-- CSS Customization -->
    <link rel="stylesheet" href="/assets/css/custom.css">

    <!-- CSS Implementing Plugins -->
    <link  rel="stylesheet" href="/assets/vendor/fancybox/jquery.fancybox.min.css">

  <link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<!-- JS Global Compulsory -->
<script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/jquery-migrate/jquery-migrate.min.js"></script>
<script src="/assets/vendor/popper.js/index.js"></script>
<script src="/assets/vendor/bootstrap/bootstrap.min.js"></script>

<!-- JS Implementing Plugins -->
<script src="/assets/vendor/appear.js"></script>
<script src="/assets/vendor/slick-carousel/slick/slick.js"></script>
<script src="/assets/vendor/hs-megamenu/src/hs.megamenu.js"></script>
<script src="/assets/vendor/fancybox/jquery.fancybox.min.js"></script>

<!-- JS Unify -->
<script src="/assets/js/hs.core.js"></script>
<script src="/assets/js/components/hs.header.js"></script>
<script src="/assets/js/helpers/hs.hamburgers.js"></script>
<script src="/assets/js/components/hs.dropdown.js"></script>
<script src="/assets/js/components/hs.carousel.js"></script>
<script src="/assets/js/components/hs.go-to.js"></script>
<script src="/assets/js/components/hs.popup.js"></script>

<!-- JS Revolution Slider -->
<script src="/assets/vendor/revolution-slider/revolution/js/jquery.themepunch.tools.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/jquery.themepunch.revolution.min.js"></script>

<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.actions.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.carousel.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.kenburn.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.layeranimation.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.migration.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.navigation.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.parallax.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.slideanims.min.js"></script>
<script src="/assets/vendor/revolution-slider/revolution/js/extensions/revolution.extension.video.min.js"></script>

<!-- JS Customization -->
<script src="/assets/js/custom.js"></script>

<!-- JS Implementing Plugins -->
<script  src="/assets/vendor/fancybox/jquery.fancybox.min.js"></script>

<!-- JS Unify -->
<script  src="/assets/js/components/hs.popup.js"></script>

<script src="https://cdn.wilddog.com/sdk/js/2.5.17/wilddog-sync.js"></script>

<script>
  function SETValue(key, value) {
    if (typeof(Storage) !== "undefined") {
      var curTime = new Date().getTime();
      localStorage.setItem(key, JSON.stringify({
        data: value,
        time: curTime
      }));
    }
  }

  function GETvalue(key) {
    if (typeof(Storage) !== "undefined") {
      var data = localStorage.getItem(key);
      if(data) {
        var dataObj = JSON.parse(data);
        if (new Date().getTime() - dataObj.time > 1000*60*60) {
          //alert("信息已过期")
        } else {
          //console.log("data="+dataObj.data);
          //console.log(JSON.parse(dataObj.data));
          var dataObjDatatoJson = dataObj.data
          return dataObjDatatoJson;
        }
      }
    }
  }

  function REQuest(url, finish) {

    var value = GETvalue(url);

    if (value) {
      finish(value);
      return;
    }

    $.ajax({
      type: "get",
      dataType: "jsonp",
      cache: true,
      url: url,
      success: function(data) {
        SETValue(url, data);
        finish(data);
      }
    });
  }


  $(document).on('ready', function() {
    // initialization of header
    $.HSCore.components.HSHeader.init($('#js-header'));
    $.HSCore.helpers.HSHamburgers.init('.hamburger');

    // initialization of MegaMenu
    $('.js-mega-menu').HSMegaMenu();

    // initialization of HSDropdown component
    $.HSCore.components.HSDropdown.init($('[data-dropdown-target]'), {
      afterOpen: function() {
        $(this).find('input[type="search"]').focus();
      }
    });
    // initialization of popups
                                $.HSCore.components.HSPopup.init('.js-fancybox');

                                // initialization of gallery with thumbs
                                $.HSCore.components.HSPopup.init('.js-fancybox-thumbs', {
                                  thumbs: {
                                    showOnStart: true
                                  }
                                });

    // initialization of go to
    $.HSCore.components.HSGoTo.init('.js-go-to');
  });
</script>

<script>

//  百度站长 推送

(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>



  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><main>

  <!-- Header -->
  <header id="js-header" class="u-header u-header--static u-shadow-v19">
    <!-- Top Bar -->
    <div class="u-header__section g-brd-bottom g-brd-gray-light-v4 g-py-18">
      <div class="container">
        <div class="row align-items-center">

          <!-- Logo -->
<div class="col-md-3 g-hidden-md-down logo">
  <a href="/" class="navbar-brand">
    <img src="/favicon/logo.png" alt="Logo">
  </a>
</div>
<!-- End Logo -->


          <style media="screen">
  .searchbox {
    border-style: hidden;
    padding: 0px;
    margin: 0px;
  }

  .markdown {
    margin: 0px;
    padding: 0px;
    position: absolute;
    top: 42px;
    border-width: 1px;
    border-style: solid;
  }

  #searchdownview {
    display: none;
  }

  #searchdownview nav {
    padding-top: 10px;
  }

  #PostSearchResults_wrapper {
    margin: 0px;
    padding-bottom: 0px;
  }

  /* 配置 没有搜索到内容的 上边距 */

  #emptymessageview {
    display: none;
  }

  #emptymessageview p {
    margin-top: 10px;
    font-weight: bold;
  }


  #searchdownview table {
    table-layout: fixed;
  }

  #searchdownview td {

    word-break: break-all;
    word-wrap: break-word;
  }



  /* 搜索结果 设置 */

  .resultlist {
    margin: 0px;
    padding: 0px;
  }

  .resultlist li {
    border-bottom-width: 1px;
    border-bottom-style: solid;
    border-bottom-color: #e0e4ea;
  }

  /* 搜索结果关键字 高粱设置 */

  .search-keyword {
    font-size: 1rem;
    color: #6281c8;
    border-bottom: 1px dashed #4088b8;
    font-weight:700;
  }

  /*  分页 前一夜 后一页 隐藏 边框 */

  .searchpage a {
    border-style: hidden;
  }
</style>


<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" charset="utf-8"></script>
<script src="/assets/js/helpers/hs.pages.table.js" charset="utf-8"></script>

<!-- Subscribe Form -->
<div class="col-lg-5 col-md-10 col-sm-10 col-xs-12">
  <form class="input-group rounded">
    <div class="form-control w-100 searchbox">
      <input class="form-control w-100
      g-brd-secondary-light-v2
      g-brd-primary--focus
      g-color-secondary-dark-v1
      g-placeholder-secondary-dark-v1
      g-bg-white g-font-weight-400
      g-font-size-13 rounded g-px-20
      g-py-12 searchinput"
      autocomplete="off"
      id="PostSearchInput" type="text" placeholder="输入以搜索该博客文章">

      <div class=" w-100 markdown g-bg-white
      g-brd-secondary-light-v2 rounded
      g-brd-primary--focus" id="searchdownview">
      <table id="PostSearchResults" ></table>
        <p class="text-center g-font-size-10" id="infomessagelabel"></p>
      </div>

      <div class=" w-100 markdown g-bg-white
      g-brd-secondary-light-v2 rounded
      g-brd-primary--focus" id="emptymessageview">
        <p class="text-center g-font-size-13">什么都没有找到</p>
      </div>

    </div>


    <span class="input-group-addon g-brd-none g-py-0 g-pr-0">
      <button id="BarrageStartButton" class="btn u-btn-white g-color-primary--hover g-bg-secondary g-font-weight-600 g-font-size-13 text-uppercase rounded g-py-12 g-px-20">
        <span class="g-hidden-md-down">search</span>
    <i class="g-hidden-lg-up fa fa-search"></i>
    </button>
    </span>
  </form>

</div>
<!-- End Subscribe Form -->



<script type="text/javascript">
  var SearchDataTablesElment;

  var SearchKeyElemnt = "search";

  var Timer = {
    data: {},
    start: function(key) {
      Timer.data[key] = new Date();
    },
    stop: function(key) {
      var time = Timer.data[key];
      if (time)
        Timer.data[key] = new Date() - time;
    },
    getTime: function(key) {
      return Timer.data[key];
    }
  };

  // AJAX 请求获取 XML 数据
  function RequestSearchXMLMethod(finish) {
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    $.ajax({
      url: path,
      dataType: "xml",
      success: function(xmlResponse) {
        // get the contents from search data
        var datas = $("entry", xmlResponse).map(function() {
          return {
            title: $("title", this).text(),
            content: $("content", this).text(),
            url: $("url", this).text()
          };
        }).get();
        WhachSearchInputMethod(datas, finish);
      }
    });
  }

  function createTemp(title, url, content) {

    if (content.length > 200) {
      content = content.substring(0, 200) + "...";
    }

    return "\
  <ul class='list-unstyled resultlist' >\
  <li class='g-pa-20 g-mb-minus-1'>\
    <!-- Article -->\
    <article>\
          <h3 class='h6'>\
            <a class='g-color-main g-color-primary--hover' href='" + url + "'>" +
      title +
      "</a>\
          </h3>\
          <p class='g-font-size-12'>" +
      content + "</p>\
        </article>\
    <!-- End Article -->\
  </li>\
  </ul>\
  ";
  }


  function WatchLeftAndRightKeyWork() {

    $(document).keydown(function(event) {

      var pointEvent = event.which == 37 || event.which == 39 || event.which == 27 || event.which == 96;

      var pointStatus = $('#searchdownview').css('display') != 'none' || $("#PostSearchInput").is(':focus') || $("#PostSearchInput").val().length > 0;

      if (pointEvent && pointStatus) {
        $("#PostSearchInput").blur(); // 失去焦点
        event.preventDefault(); // 组织键盘
        switch (event.which) { //判断按键;
          case 37: // 上一页
            SearchDataTablesElment.page('previous').draw('page');
            break;
          case 39: // 下一页
            SearchDataTablesElment.page('next').draw('page');
            break;
          case 27:
          case 96:
            $("#PostSearchInput").val("");
            $("#PostSearchInput").trigger("input");
            break;
          default:
            break;
        }
      }
    });
  }

  // 监视输入框的一些输入问题
  // @params data XML 解析出来的JOSN 数据
  // @params finish 检测到输入框修改之后 回调的数据
  //
  // @return nil
  function WhachSearchInputMethod(datas, finish) {

    WatchLeftAndRightKeyWork();

    $("#PostSearchInput").on('input', function(e) {

      var startTime = new Date().getTime(); // 开始时间

      var dataSet = [];
      var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
      if (this.value.trim().length <= 0) {
        finish(keywords, dataSet);
        return;
      }
      // perform local searching
      datas.forEach(function(data) {
        var isMatch = true;
        var content_index = [];
        var data_title = data.title.trim().toLowerCase();
        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
        var data_url = data.url;
        var index_title = -1;
        var index_content = -1;
        var first_occur = -1;
        // only match artiles with not empty titles and contents
        if (data_title != '' && data_content != '') {
          keywords.forEach(function(keyword, i) {
            index_title = data_title.indexOf(keyword);
            index_content = data_content.indexOf(keyword);
            if (index_title < 0 && index_content < 0) {
              isMatch = false;
            } else {
              if (index_content < 0) {
                index_content = 0;
              }
              if (i == 0) {
                first_occur = index_content;
              }
            }
          });
        }
        // show search results
        if (isMatch) {
          var content = data.content.trim().replace(/<[^>]+>/g, "");
          if (first_occur >= 0) {
            // cut out characters
            var start = first_occur - 6;
            var end = first_occur + 6;
            if (start < 0) {
              start = 0;
            }
            if (start == 0) {
              end = 10;
            }
            if (end > content.length) {
              end = content.length;
            }
            var match_content = content.substr(start, end);
            // highlight all keywords
            keywords.forEach(function(keyword) {
              var regS = new RegExp(keyword, "gi");
              data_title = data_title.replace(regS, "<strong class=\"search-keyword\">" + keyword + "</strong>");
              match_content = match_content.replace(regS, "<strong class=\"search-keyword\">" + keyword + "</strong>");
            });
            var datas = [createTemp(data_title, data_url, match_content)];
            dataSet.push(datas);
          };
        };
      });

      var endTime = new Date().getTime(); // 开始时间

      finish(keywords, dataSet, endTime - startTime);
    });
  };

  function EmptyViewHandleMethod(datacount) {
    if (datacount <= 0 && $("#PostSearchInput").val().length > 0) {
      $("#emptymessageview").attr("style", "display:block;"); //隐藏div
    } else {
      $("#emptymessageview").attr("style", "display:none;"); //显示div
    }
  }

  function InitSearchInterfaceMethod() {

    $("#PostSearchInput").focus(function(){
        if ($("#PostSearchInput").val().length > 0) {
          $("#PostSearchInput").trigger("input");
        }
    });

    RequestSearchXMLMethod(function(keywords, datas, times) {
      if (datas.length <= 0) {
        $("#searchdownview").attr("style", "display:none;"); //隐藏div
      } else {
        $("#searchdownview").attr("style", "display:block;"); //显示div
      }
      EmptyViewHandleMethod(datas.length);
      if (!SearchDataTablesElment) {
        SearchDataTablesElment = $('#PostSearchResults').DataTable({
          data: datas,
          autoWidth: false,
          ordering: false,
          searching: false,
          lengthChange: false,
          pageLength: 4,
          info: false,
          iShowPages: 3,
          pagingType: "cutsomPage",
          footerCallback: function(tfoot, data, start, end, display) {

            var keyWorkd = "<span style='color: #6281c8;font-weight: bold;'>" + $("#PostSearchInput").val() + "</span>";

            var title = "查询[" + keyWorkd + "]结果共" + data.length + "个,总耗时" + times / 1000 + "秒";

            $("#infomessagelabel").html(title);
          },
          columns: [{
            title: ""
          }]
        });
      } else {
        SearchDataTablesElment.clear().rows.add(datas).draw();
      }



    });
  };

  $(document).ready(function() {

    InitSearchInterfaceMethod();
  });
</script>


          <!-- Language -->
<div id="clock" class="col-xl-2 col-md-2 col-sm-2 g-hidden-xs-down ml-auto ">
</div>
<!-- End Language -->


<script type="text/javascript">

var counter;

var config = {
  syncURL: "https://wd2622139095udguuj.wilddogio.com" //输入节点 URL
};
wilddog.initializeApp(config);
var ref = wilddog.sync().ref("browerlog");

ref.push({
  "url": window.location.href,
  "path": window.location.pathname,
  "date": Math.round(new Date().getTime())
});

ref.orderByChild("path").equalTo(window.location.pathname).on('value', function(snapshot) {

  var value = snapshot.val() == null ? 0 : Object.keys(snapshot.val()).length

  $("#clock").text("No."+value);
});

var zan = wilddog.sync().ref("dianzan");

zan.on('value', function(snapshot) {
    counter = snapshot.val();
    $("#counter").html(""+counter);
  }, function (error) {
    console.log(error);
  });


function zanUpMethod(){
  zan.set(counter+1)
}
function zanDownMethod(){
  zan.set(counter-1)
}

</script>


          <!-- Account -->
<div class="col-1 g-hidden-md-down" id="account">
  <a id="account-dropdown-invoker" class="media align-items-center float-right g-text-underline--none--hover" href="#"
     aria-controls="account-dropdown"
     aria-haspopup="true"
     aria-expanded="false"
     data-dropdown-event="hover"
     data-dropdown-target="#account-dropdown"
     data-dropdown-type="css-animation"
     data-dropdown-duration="300"
     data-dropdown-hide-on-scroll="false"
     data-dropdown-animation-in="fadeIn"
     data-dropdown-animation-out="fadeOut">
    <div class="d-flex g-width-30 g-height-30 mr-2">
      <img class="img-fluid rounded-circle" src="http://blog.msiter.com/favicon/avatar.jpg" alt="Image Description">
    </div>
    <div class="media-body">
      <span class="d-block g-hidden-sm-down g-color-main g-font-weight-600 g-font-size-13">文征</span>
    </div>
  </a>

  <div id="account-dropdown" class="list-unstyled g-brd-around g-brd-secondary-light-v2 g-bg-white rounded g-pos-abs g-right-0 g-py-5 g-mt-57" aria-labelledby="account-dropdown-invoker" style="width:300px;">






    <div class="col-lg-12 g-mb-30">
        <!-- Figure -->
        <figure class="u-shadow-v19 g-bg-white g-rounded-4 g-pa-20">

          <div id="counter" class="text-center g-font-size-20">

            0

          </div>

          <hr class="g-brd-gray-light-v4 g-my-15">

          <div class="d-flex justify-content-start">
            <!-- Figure Image -->
            <img class="g-width-90 g-height-90 rounded-circle g-mr-15" src="http://blog.msiter.com/favicon/avatar.jpg" alt="Image Description">
            <!-- Figure Image -->

            <div class="d-block">
              <!-- Figure Info -->
              <div class="g-mb-5">
                <h4 class="h5 g-mb-1">荆文征</h4>
                <em class="d-block g-color-gray-dark-v4 g-font-style-normal g-font-size-13">Zhidu Inc.</em>
              </div>
              <!-- End Figure Info -->

              <!-- Social Icons -->
              <ul class="list-inline mb-0">
                <li class="list-inline-item g-mx-2">
                  <a class="u-icon-v1 u-icon-slide-up--hover g-color-gray-dark-v4 g-color-facebook--hover g-ml-minus-15" href="javascript:;" onclick="zanUpMethod()">
                    <i class="g-font-size-default g-line-height-1 u-icon__elem-regular fa fa-thumbs-o-up"></i>
                    <i class="g-font-size-default g-line-height-0_8 u-icon__elem-hover fa fa-thumbs-up"></i>
                  </a>
                </li>
                <li class="list-inline-item g-mx-2">
                  <a class="u-icon-v1 u-icon-slide-up--hover g-color-gray-dark-v4 g-color-twitter--hover" href="javascript:void(0)" onclick="zanDownMethod()">
                    <i class="g-font-size-default g-line-height-1 u-icon__elem-regular fa fa-thumbs-o-down"></i>
                    <i class="g-font-size-default g-line-height-0_8 u-icon__elem-hover fa fa-thumbs-down"></i>
                  </a>
                </li>
              </ul>
              <!-- End Social Icons -->
            </div>
          </div>

          <hr class="g-brd-gray-light-v4 g-my-15">

          <div class="g-py-10">
            <!-- Figure Contacts -->
            <ul class="list-unstyled g-color-gray-dark-v5 g-font-size-13 g-mb-0">
              <li class="g-mb-10">
                <i class="g-pos-rel g-mt-1 mr-2 icon-communication-062 u-line-icon-pro"></i>
                <a href="mailto:alphabetion@gmail.com">alphabetion@gmail.com</a>
              </li>
              <li>
                <i class="g-pos-rel g-top-1 mr-2 icon-electronics-005 u-line-icon-pro"></i>
                <em class="g-font-style-normal">+(86) 136 0135 6004</em>
              </li>
            </ul>
            <!-- End Figure Contacts -->
          </div>

          <hr class="g-brd-gray-light-v4 g-my-15">
            <!-- Border Primary Blockquotes -->
            <blockquote class="blockquote g-brd-2 g-brd-primary g-font-size-12 g-mb-30">
              <p class="content"></p>
              <footer class="blockquote-footer text-right">
                <cite title="Source Title" class="author"></cite>
              </footer>
            </blockquote>
            <!-- End Border Primary Blockquotes -->
        </figure>
        <!-- End Figure -->
      </div>







  </div>


</div>
<!-- End Account -->

<script type="text/javascript">

$("#account").mouseover(function(){


});

$("#account").mouseout(function(){

});

</script>


        </div>
      </div>
    </div>
    <!-- End Top Bar -->

    <div class="u-header__section u-header__section--light g-bg-white g-transition-0_3 g-py-10">
      <nav class="js-mega-menu navbar navbar-expand-lg g-px-0">
        <div class="container g-px-15">
          <!-- Logo -->
          <a class="navbar-brand g-hidden-lg-up" href="bm-classic-home-page-1.html">
            <img src="/assets/img/logo.png" alt="Logo">
          </a>
          <!-- End Logo -->

          <!-- Responsive Toggle Button -->
          <button class="navbar-toggler navbar-toggler-right btn g-line-height-1 g-brd-none g-pa-0 ml-auto" type="button"
                  aria-label="Toggle navigation"
                  aria-expanded="false"
                  aria-controls="navBar"
                  data-toggle="collapse"
                  data-target="#navBar">
            <span class="hamburger hamburger--slider g-pa-0">
              <span class="hamburger-box">
                <span class="hamburger-inner"></span>
              </span>
            </span>
          </button>
          <!-- End Responsive Toggle Button -->

          <!-- Navigation -->
          <div class="collapse navbar-collapse align-items-center flex-sm-row g-pt-10 g-pt-5--lg" id="navBar">
            <ul class="navbar-nav g-font-weight-600">

              <!-- Mega Menu Item -->
<li class="hs-has-mega-menu nav-item g-mx-10--lg g-mx-20--xl"
    data-animation-in="fadeIn"
    data-animation-out="fadeOut"
    data-position="right">
  <a id="mega-menu-label-1" class="nav-link text-uppercase g-px-0" href="#" aria-haspopup="true" aria-expanded="false">标签
    <i class="hs-icon hs-icon-arrow-bottom g-font-size-11 g-ml-5"></i></a>

  <!-- Mega Menu -->
  <div class="hs-mega-menu u-shadow-v11 g-text-transform-none g-font-weight-400 g-brd-top g-brd-primary g-brd-top-2 g-bg-white g-left-15 g-right-15 g-pa-30 g-mt-17 g-mt-7--lg--scrolling" aria-labelledby="mega-menu-label-1">
    <div class="row">
      <div class="col-lg-2">
        <ul class="list-unstyled mb-0" style="ov">

          

                      <li class="g-brd-bottom g-brd-gray-light-v4 g-py-10">
                        <a class="g-color-main g-color-main--hover" href="/tags/生活/">生活</a></li>

            

                      <li class="g-brd-bottom g-brd-gray-light-v4 g-py-10">
                        <a class="g-color-main g-color-main--hover" href="/tags/悲观/">悲观</a></li>

            

                      <li class="g-brd-bottom g-brd-gray-light-v4 g-py-10">
                        <a class="g-color-main g-color-main--hover" href="/tags/Objective-C/">Objective-C</a></li>

            

                      <li class="g-brd-bottom g-brd-gray-light-v4 g-py-10">
                        <a class="g-color-main g-color-main--hover" href="/tags/AsyncDisplayKit/">AsyncDisplayKit</a></li>

            

                      <li class="g-brd-bottom g-brd-gray-light-v4 g-py-10">
                        <a class="g-color-main g-color-main--hover" href="/tags/ios/">ios</a></li>

            

        </ul>
      </div>
      <div class="col-lg-1">

      </div>
      <div class="col-lg-9" style="height:auto;" >

        <!-- Background Gray Colored -->
        <ul class="u-list-inline">

          

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/约束教程/">约束教程</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/AttributedString/">AttributedString</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/iOS8-html2AttributedString-error/">iOS8 html2AttributedString error</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/IOS/">IOS</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/ObjC/">ObjC</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Pthreads/">Pthreads</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/线程/">线程</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/POSIX/">POSIX</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/RxSwift/">RxSwift</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Moya/">Moya</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/java/">java</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/spring-boot/">spring boot</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/mybatis/">mybatis</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/WKWebView/">WKWebView</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Systematic-distinction/">Systematic distinction</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/WebKit/">WebKit</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/WebView/">WebView</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/UIWebView/">UIWebView</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Input/">Input</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/File/">File</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Bug/">Bug</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/稀奇古怪的问题/">稀奇古怪的问题</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/博客美化/">博客美化</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/hexo/">hexo</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/mathjax/">mathjax</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/objc/">objc</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/travis-ci/">travis-ci</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/cocoapods/">cocoapods</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/NodeJS/">NodeJS</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/APNs/">APNs</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/八爪鱼/">八爪鱼</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/html/">html</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/js/">js</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Javascript/">Javascript</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/鼠标悬浮/">鼠标悬浮</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/面试题目/">面试题目</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/递归/">递归</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/error/">error</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/奇怪的问题/">奇怪的问题</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/希望/">希望</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/家庭/">家庭</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/测试/">测试</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/MARKDOWN/">MARKDOWN</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/无趣，心理学/">无趣，心理学</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Iterm/">Iterm</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/zsh/">zsh</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/主题/">主题</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/hashimoto/">hashimoto</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/论文/">论文</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/共识算法/">共识算法</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/技巧/">技巧</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/swift/">swift</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Waver/">Waver</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/AVFoundation/">AVFoundation</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/逆向/">逆向</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/theos/">theos</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/tweak/">tweak</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/mongodb/">mongodb</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/mongoose/">mongoose</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/nodejs/">nodejs</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/RX/">RX</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/c/">c</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/c/">c++</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/reactiv/">reactiv</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/rxswift/">rxswift</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/swagger/">swagger</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/api/">api</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Web3js/">Web3js</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Ethereum/">Ethereum</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Solidity/">Solidity</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/truffle/">truffle</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/ganache/">ganache</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/数据结构/">数据结构</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/计算机基础/">计算机基础</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/手势密码/">手势密码</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/autolayout/">autolayout</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/破解/">破解</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/抓包/">抓包</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/DB/">DB</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/realm/">realm</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/jooq/">jooq</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/paoxs/">paoxs</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/越狱/">越狱</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/cydia/">cydia</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/制作源/">制作源</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Segwit/">Segwit</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Lightning-Network/">Lightning Network</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Atomic-Transaction/">Atomic Transaction</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/HD-Wallet/">HD Wallet</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/BIP32-44/">BIP32-44</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/Block-chain/">Block chain</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/multi-paoxs/">multi-paoxs</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/async/">async</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/区块链/">区块链</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/p2p/">p2p</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/dns-seed/">dns seed</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/PBFT/">PBFT</a>
                        </li>

            

                        <li class="list-inline-item g-mb-10">
                          <a class="u-tags-v1 g-color-main g-bg-gray-light-v4 g-bg-black--hover g-color-white--hover g-py-4 g-px-10" href="/tags/consensus/">consensus</a>
                        </li>

            

        </ul>
        <!-- End Background Gray Colored -->

      </div>
    </div>
  </div>
  <!-- End Mega Menu -->
</li>

              <!-- Mega Menu Item -->
<li class="hs-has-mega-menu nav-item g-mx-10--lg g-mx-20--xl"
    data-animation-in="fadeIn"
    data-animation-out="fadeOut"
    data-position="right">
  <a id="mega-menu-label-5" class="nav-link text-uppercase g-px-0" href="#" aria-haspopup="true" aria-expanded="false">栏目
    <i class="hs-icon hs-icon-arrow-bottom g-font-size-11 g-ml-5"></i></a>

  <!-- Mega Menu -->
  <div class="hs-mega-menu u-shadow-v11 g-text-transform-none g-font-weight-400 g-brd-top g-brd-primary g-brd-top-2 g-bg-primary g-left-15 g-right-15 g-px-30 g-mt-17 g-mt-7--lg--scrolling" aria-labelledby="mega-menu-label-5">
    <div class="row">
      <div class="col-lg-12">
        <ul class="list-inline text-center mb-0">



          

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/牢骚/">牢骚</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/IOS/">IOS</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/学习/">学习</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/线程/">线程</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/服务器/">服务器</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/博客历程/">博客历程</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/学习资料/">学习资料</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/Web-前端/">Web 前端</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/面试题目/">面试题目</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/生活/">生活</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/测试用例/">测试用例</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/hexo/">hexo</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/共识算法/">共识算法</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/开发帮助/">开发帮助</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/区块链/">区块链</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/数据结构/">数据结构</a>
                        </li>

            

                        <li class="list-inline-item">
                          <a class="d-inline-block g-color-white-opacity-0_8 g-color-white--hover g-px-10 g-py-15" href="/categories/ios/">ios</a>
                        </li>

            


        </ul>
      </div>
    </div>
  </div>
  <!-- End Mega Menu -->
</li>
<!-- End Mega Menu Item -->

              <!-- Mega Menu Item -->
<li class="hs-has-mega-menu nav-item g-mx-10--lg g-mx-20--xl"
    data-animation-in="fadeIn"
    data-animation-out="fadeOut"
    data-position="right">
  <a id="mega-menu-label-3" class="nav-link text-uppercase g-px-0" href="#" aria-haspopup="true" aria-expanded="false">最新文章
    <i class="hs-icon hs-icon-arrow-bottom g-font-size-11 g-ml-5"></i></a>

  <!-- Mega Menu -->
  <div class="hs-mega-menu u-shadow-v11 g-text-transform-none g-font-weight-400 g-brd-top g-brd-primary g-brd-top-2 g-bg-white g-left-15 g-right-15 g-pa-30 g-mt-17 g-mt-7--lg--scrolling" aria-labelledby="mega-menu-label-3">
    <div class="row">
      <div class="col-lg-4">
        <article>
          <figure class="g-pos-rel">
            <img class="img-fluid w-100 g-mb-20" src="/assets/img-temp/900x600/img7.jpg" alt="Image Description">
          </figure>
          <h3 class="h4 g-mb-10"><a class="g-color-gray-dark-v2" href="#">Love the mother nature</a>
          </h3>
          <ul class="u-list-inline g-font-size-12 g-color-gray-dark-v4">
            <li class="list-inline-item">
              <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">Kathy Reyes</a>
            </li>
            <li class="list-inline-item">/</li>
            <li class="list-inline-item">July 20, 2016</li>
            <li class="list-inline-item">/</li>
            <li class="list-inline-item">
              <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">
                <i class="fa fa-comments-o"></i> 18
              </a>
            </li>
          </ul>
        </article>
      </div>
      <div class="col-lg-4">
        <article class="media g-mb-20">
          <a class="d-flex mr-3" href="#"><img class="g-width-120 g-height-70" src="/assets/img-temp/500x320/img1.jpg" alt="Image Description"></a>
          <div class="media-body">
            <h3 class="h6">
              <a class="g-color-main" href="#">Top 10 Luxury Hotels - 5 Star Best Luxury Hotels</a>
            </h3>
            <ul class="u-list-inline g-font-size-12 g-color-gray-dark-v4">
              <li class="list-inline-item">July 07, 2016</li>
              <li class="list-inline-item">/</li>
              <li class="list-inline-item">
                <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">
                  <i class="fa fa-comments-o"></i> 24
                </a>
              </li>
            </ul>
          </div>
        </article>

        <article class="media g-mb-20">
          <a class="d-flex mr-3" href="#"><img class="g-width-120 g-height-70" src="/assets/img-temp/500x320/img2.jpg" alt="Image Description"></a>
          <div class="media-body">
            <h3 class="h6"><a class="g-color-main" href="#">10 Most beautiful beaches</a></h3>
            <ul class="u-list-inline g-font-size-12 g-color-gray-dark-v4">
              <li class="list-inline-item">July 20, 2016</li>
              <li class="list-inline-item">/</li>
              <li class="list-inline-item">
                <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">
                  <i class="fa fa-comments-o"></i> 18
                </a>
              </li>
            </ul>
          </div>
        </article>

        <article class="media g-mb-20">
          <a class="d-flex mr-3" href="#"><img class="g-width-120 g-height-70" src="/assets/img-temp/500x320/img3.jpg" alt="Image Description"></a>
          <div class="media-body">
            <h3 class="h6">
              <a class="g-color-main" href="#">Stylish things to do, see and buy this week</a></h3>
            <ul class="u-list-inline g-font-size-12 g-color-gray-dark-v4">
              <li class="list-inline-item">July 16, 2016</li>
              <li class="list-inline-item">/</li>
              <li class="list-inline-item">
                <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">
                  <i class="fa fa-comments-o"></i> 31
                </a>
              </li>
            </ul>
          </div>
        </article>
      </div>
      <div class="col-lg-4">
        <article class="media g-mb-20">
          <a class="d-flex mr-3" href="#"><img class="g-width-120 g-height-70" src="/assets/img-temp/500x320/img1.jpg" alt="Image Description"></a>
          <div class="media-body">
            <h3 class="h6">
              <a class="g-color-main" href="#">8 health benefits and drawbacks of coffee</a></h3>
            <ul class="u-list-inline g-font-size-12 g-color-gray-dark-v4">
              <li class="list-inline-item">July 30, 2016</li>
              <li class="list-inline-item">/</li>
              <li class="list-inline-item">
                <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">
                  <i class="fa fa-comments-o"></i> 12
                </a>
              </li>
            </ul>
          </div>
        </article>

        <article class="media g-mb-20">
          <a class="d-flex mr-3" href="#"><img class="g-width-120 g-height-70" src="/assets/img-temp/500x320/img2.jpg" alt="Image Description"></a>
          <div class="media-body">
            <h3 class="h6">
              <a class="g-color-main" href="#">Stylish things to do, see and buy this week</a></h3>
            <ul class="u-list-inline g-font-size-12 g-color-gray-dark-v4">
              <li class="list-inline-item">July 16, 2016</li>
              <li class="list-inline-item">/</li>
              <li class="list-inline-item">
                <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">
                  <i class="fa fa-comments-o"></i> 31
                </a>
              </li>
            </ul>
          </div>
        </article>

        <article class="media g-mb-20">
          <a class="d-flex mr-3" href="#"><img class="g-width-120 g-height-70" src="/assets/img-temp/500x320/img3.jpg" alt="Image Description"></a>
          <div class="media-body">
            <h3 class="h6">
              <a class="g-color-main" href="#">Top 10 Luxury Hotels - 5 Star Best Luxury Hotels</a>
            </h3>
            <ul class="u-list-inline g-font-size-12 g-color-gray-dark-v4">
              <li class="list-inline-item">July 07, 2016</li>
              <li class="list-inline-item">/</li>
              <li class="list-inline-item">
                <a class="g-color-gray-dark-v4 g-text-underline--none--hover" href="#">
                  <i class="fa fa-comments-o"></i> 24
                </a>
              </li>
            </ul>
          </div>
        </article>
      </div>
    </div>
  </div>
  <!-- End Mega Menu -->
</li>
<!-- End Mega Menu Item -->

              <!-- Mega Menu Item -->
<li class="hs-has-mega-menu nav-item g-mx-10--lg g-mx-20--xl"
    data-animation-in="fadeIn"
    data-animation-out="fadeOut"
    data-position="right">
  <a id="mega-menu-label-4" class="nav-link text-uppercase g-px-0" href="#" aria-haspopup="true" aria-expanded="false">最火文章
    <i class="hs-icon hs-icon-arrow-bottom g-font-size-11 g-ml-5"></i></a>

  <!-- Mega Menu -->
  <div class="hs-mega-menu u-shadow-v11 g-text-transform-none g-font-weight-400 g-brd-top g-brd-primary g-brd-top-2 g-bg-white g-left-15 g-right-15 g-pa-30 g-mt-17 g-mt-7--lg--scrolling" aria-labelledby="mega-menu-label-4">
    <div class="row">
      <div class="col-lg-4">
        <article class="u-block-hover">
          <figure class="g-bg-cover g-bg-black-gradient-opacity-v1--after">
            <img class="img-fluid u-block-hover__main--zoom-v1" src="/assets/img-temp/500x320/img1.jpg" alt="Image Description">
          </figure>
          <span class="g-pos-abs g-top-20 g-left-20">
          <a class="btn btn-sm u-btn-red rounded-0" href="#">Fashion</a>
        </span>
          <span class="u-icon-v3 u-icon-size--sm g-bg-white g-color-black g-rounded-50x g-cursor-pointer g-pos-abs g-top-20 g-right-20">
          <i class="icon-camera"></i>
        </span>
          <header class="g-pos-abs g-bottom-10 g-left-20 g-right-20">
            <small class="g-color-white">
              <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> July 26, 2016
            </small>
            <h3 class="h4 g-font-weight-600 g-mt-5">
              <a class="g-color-white g-color-white--hover" href="#">Be ready, fashion of the year is coming this year</a>
            </h3>
          </header>
        </article>
      </div>
      <div class="col-lg-4">
        <article class="u-block-hover">
          <figure class="g-bg-cover g-bg-black-gradient-opacity-v1--after">
            <img class="img-fluid u-block-hover__main--zoom-v1" src="/assets/img-temp/500x320/img2.jpg" alt="Image Description">
          </figure>
          <span class="g-pos-abs g-top-20 g-left-20">
          <a class="btn btn-sm u-btn-red rounded-0" href="#">Beaches</a>
        </span>
          <span class="u-icon-v3 u-icon-size--sm g-bg-white g-color-black g-rounded-50x g-cursor-pointer g-pos-abs g-top-20 g-right-20">
          <i class="icon-camera"></i>
        </span>
          <header class="g-pos-abs g-bottom-10 g-left-20 g-right-20">
            <small class="g-color-white">
              <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> July 15, 2016
            </small>
            <h3 class="h4 g-font-weight-600 g-mt-5">
              <a class="g-color-white g-color-white--hover" href="#">Must be visited places in the USA - Florida Beaches</a>
            </h3>
          </header>
        </article>
      </div>
      <div class="col-lg-4">
        <article class="u-block-hover">
          <figure class="g-bg-cover g-bg-black-gradient-opacity-v1--after">
            <img class="img-fluid u-block-hover__main--zoom-v1" src="/assets/img-temp/500x320/img3.jpg" alt="Image Description">
          </figure>
          <span class="g-pos-abs g-top-20 g-left-20">
          <a class="btn btn-sm u-btn-red rounded-0" href="#">Food</a>
        </span>
          <span class="u-icon-v3 u-icon-size--sm g-bg-white g-color-black g-rounded-50x g-cursor-pointer g-pos-abs g-top-20 g-right-20">
          <i class="icon-camera g-left-2"></i>
        </span>
          <header class="g-pos-abs g-bottom-10 g-left-20 g-right-20">
            <small class="g-color-white">
              <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> July 8, 2016
            </small>
            <h3 class="h4 g-font-weight-600 g-mt-5">
              <a class="g-color-white g-color-white--hover" href="#">Why your next glass of juice will cost you more</a>
            </h3>
          </header>
        </article>
      </div>
    </div>
  </div>
  <!-- End Mega Menu -->
</li>
<!-- End Mega Menu Item -->

              <!-- Mega Menu Item -->
<li class="hs-has-mega-menu nav-item g-mx-10--lg g-ml-15--xl"
    data-animation-in="fadeIn"
    data-animation-out="fadeOut"
    data-position="right">
  <a id="mega-menu-label-7" class="nav-link text-uppercase g-px-0" href="#" aria-haspopup="true" aria-expanded="false">新闻热点
    <i class="hs-icon hs-icon-arrow-bottom g-font-size-11 g-ml-5"></i></a>

  <!-- Mega Menu -->
  <div class="hs-mega-menu u-shadow-v11 g-text-transform-none g-font-weight-400 g-brd-top g-brd-primary g-brd-top-2 g-bg-white g-left-15 g-right-15 g-pa-30 g-mt-17 g-mt-7--lg--scrolling" aria-labelledby="mega-menu-label-7">
    <div class="row">
      <div class="col-lg-3 g-mb-20 g-mb-0--lg">
        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> Aug 16, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">You've been making French Pie all wrong - Until Now</a>
          </h3>
        </article>
        <!-- End Article -->

        <hr class="g-mt-15 g-mb-10">

        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> Aug 02, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">Unify facts, study finds - sensitive to gluten without having coeliac disease</a>
          </h3>
        </article>
        <!-- End Article -->
      </div>

      <div class="col-lg-3 g-mb-20 g-mb-0--lg">
        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> July 18, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">Why your next cup of cofee with milk will cost you more</a>
          </h3>
        </article>
        <!-- End Article -->

        <hr class="g-mt-15 g-mb-10">

        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> July 12, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">Incredible product and quality: Unify best template of the year</a>
          </h3>
        </article>
        <!-- End Article -->
      </div>

      <div class="col-lg-3 g-mb-20 g-mb-0--lg">
        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> Aug 16, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">Some post title will be implimented here and It's cool!</a>
          </h3>
        </article>
        <!-- End Article -->

        <hr class="g-mt-15 g-mb-10">

        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> Aug 02, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">Wireframe approach for the news blocks and pages</a>
          </h3>
        </article>
        <!-- End Article -->
      </div>

      <div class="col-lg-3 g-mb-20 g-mb-0--lg">
        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> July 18, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">Over thousands of components help you to boost your project</a>
          </h3>
        </article>
        <!-- End Article -->

        <hr class="g-mt-15 g-mb-10">

        <!-- Article -->
        <article>
          <div class="g-font-size-12 g-mb-5">
            <i class="icon-clock g-pos-rel g-top-1 g-mr-2"></i> July 12, 2016
          </div>

          <h3 class="h6">
            <a class="g-color-main" href="#">How to run a ticket: Best 10 point approaches for people who stands..</a>
          </h3>
        </article>
        <!-- End Article -->
      </div>
    </div>
  </div>
  <!-- End Mega Menu -->
</li>
<!-- End Mega Menu Item -->

              <!-- Main -->
<li class="nav-item g-mx-10--lg g-mx-20--xl">
  <a id="nav-link--pages" class="nav-link text-uppercase g-color-primary--hover g-px-0" href="/">
    主页
  </a>
</li>
<!-- End Main -->








            </ul>
          </div>
          <!-- End Navigation -->
        </div>
      </nav>
    </div>
  </header>
  <!-- End Header -->



            <style media="screen">
  .barrage {
    width: 100%;
    background-color: #6281c8;
    position: fixed;
    top: 0px;
    display: none;
  }

  .barrage .logo {
    visibility: hidden;
  }
</style>

<header id="BarrageInputView" class="u-header u-header--static u-shadow-v19 barrage">
  <div class="u-header__section g-brd-bottom g-brd-gray-light-v4 g-py-18">
    <div class="container">
      <div class="row align-items-center">

        <!-- Logo -->
<div class="col-md-3 g-hidden-md-down logo">
  <a href="/" class="navbar-brand">
    <img src="/favicon/logo.png" alt="Logo">
  </a>
</div>
<!-- End Logo -->


          <h3 class="col-4 col-lg-2 g-pos-rel g-px-15 ml-auto text-center g-color-white">你好，再见</h3>

      </div>
    </div>
  </div>
</header>


<script type="text/javascript">
  $(document).ready(function() {

    var barrageInputView = $("#BarrageInputView");

    $("#BarrageStartButton").click(function(event) {

      barrageInputView.css("display", "block");
      barrageInputView.css("top", "-300px");

      console.log("这个按钮一点用都没有.直接搜索就好了");

      barrageInputView.animate({
        top: "0",
      }, 1000, function() {
        setTimeout(function() {

          barrageInputView.animate({
            top: "-200"
          }, 1000,function(){
            barrageInputView.css("display", "none");
          });

        }, 1000);
      });

    });
  });
</script>



    

<section class="g-pt-50 g-pb-100">
  <div class="container">
    <div class="row">
      <!-- Articles Content -->
      <div class="col-lg-9 g-mb-50 g-mb-0--lg">
        <article class="g-mb-60">
          <header class="g-mb-30">
            <h2 class="h1 g-mb-15">Nodejs Async 学习</h2>

            <ul id="editHtmlElement" class="list-inline d-sm-flex g-color-gray-dark-v4 mb-0">
              <li class="list-inline-item">
                小酒馆老板
              </li>
              <li class="list-inline-item g-mx-10">/</li>
              <li class="list-inline-item">
                2015/7/6 18:41:43
              </li>
              <li class="list-inline-item g-mx-10">/</li>
              <li class="list-inline-item g-mr-10">
                <i class="align-middle mr-2 icon-hotel-restaurant-242 u-line-icon-pro"></i>共有
                12,355个字
              </li>
              <li class="list-inline-item g-mx-10">/</li>
              <li class="list-inline-item g-mr-10">
                <i class="align-middle mr-2 icon-hotel-restaurant-003 u-line-icon-pro"></i>预计阅读
                61分钟
              </li>
            </ul>

            <hr class="g-brd-gray-light-v4 g-my-15">

          </header>

          <div class="">
            <p>           <figure class="mb-4 text-center">              <a class="js-fancybox-thumbs" href="/publicFiles/images/stock-photo/stock-photo-151005535.jpg" title="Lightbox Gallery" data-fancybox-gallery="lightbox-gallery-2" data-fancybox-speed="500" data-fancybox-slide-speed="1000">                <br><img class="img-fluid g-brd-around g-brd-gray-light-v4 g-line-height-2" src="/publicFiles/images/stock-photo/stock-photo-151005535.jpg" alt="Image Description">              </a><figcaption class="figure-caption g-font-size-12 g-color-gray-dark-v4 g-mt-5 text-center">让你难过的事情，有一天，你一定会笑着说出来。</figcaption></figure></p>
                                <div class="g-brd-around g-brd-gray-light-v4 g-brd-2 g-brd-red-left g-line-height-1_8 g-pa-30 g-mb-30">                                  <em style="padding:0px;margin:0px;">
<p>本文整理于<a href="https://github.com/bsspirit" target="_blank" rel="noopener"><code>bsspirit</code></a>的<a href="http://blog.fens.me/nodejs-async/" target="_blank" rel="noopener">博文</a>和<a href="https://github.com/bsspirit/async_demo" target="_blank" rel="noopener">代码示例</a></p>
</em>                                </div>        
<p><code>Async</code>是一个流程控制工具包，提供了直接而强大的异步功能。基于<code>Javascript</code>为<code>Node.js</code>设计，同时也可以直接在浏览器中使用。<br><code>Async</code>提供了大约20个函数，包括常用的<code>map</code>,<code>reduce</code>, <code>filter</code>, <code>forEach</code> 等，异步流程控制模式包括，串行(<code>series</code>)，并行(<code>parallel</code>)，瀑布(<code>waterfall</code>)等。</p>
<a id="more"></a>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H2   </span><h2 id="项目简介" style="display: inline;"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p><a href="https://github.com/caolan/async" target="_blank" rel="noopener">Async</a>  </p>
<p><em>For Async v1.5.x documentation, go <a href="https://github.com/caolan/async/blob/v1.5.2/README.md" target="_blank" rel="noopener">HERE</a></em></p>
<p>Async is a utility module which provides straight-forward, powerful functions<br>for working with asynchronous JavaScript. Although originally designed for<br>use with <a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a> and installable via <code>npm install --save async</code>,<br>it can also be used directly in the browser.</p>
<p>Async is also installable via:</p>
<ul class="g-list-style-circle">
<li><a href="http://bower.io/" target="_blank" rel="noopener">bower</a>: <code>bower install async</code></li>
<li><a href="https://github.com/componentjs/component" target="_blank" rel="noopener">component</a>: <code>component install caolan/async</code></li>
<li><a href="http://jamjs.org/" target="_blank" rel="noopener">jam</a>: <code>jam install async</code></li>
</ul>
<p>Async provides around 70 functions that include the usual ‘functional’<br>suspects (<code>map</code>, <code>reduce</code>, <code>filter</code>, <code>each</code>…) as well as some common patterns<br>for asynchronous control flow (<code>parallel</code>, <code>series</code>, <code>waterfall</code>…). All these<br>functions assume you follow the Node.js convention of providing a single<br>callback as the last argument of your asynchronous function – a callback which expects an Error as its first argument – and calling the callback once.</p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H2   </span><h2 id="功能简介" style="display: inline;"><a href="#功能简介" class="headerlink" title="功能简介"></a>功能简介</h2><p><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="集合-Collections" style="display: inline;"><a href="#集合-Collections" class="headerlink" title="集合:Collections"></a>集合:<code>Collections</code></h3><ul class="g-list-style-circle">
<li><a href="#each"><code>each</code></a>: 如果想对同一个集合中的所有元素都执行同一个异步操作。</li>
<li><a href="#map"><code>map</code></a>: 对集合中的每一个元素，执行某个异步操作，得到结果。所有的结果将汇总到最终的callback里。与each的区别是，each只关心操作不管最后的值，而map关心的最后产生的值。</li>
<li><a href="#filter"><code>filter</code></a>: 使用异步操作对集合中的元素进行筛选, 需要注意的是，iterator的callback只有一个参数，只能接收true或false。</li>
<li><a href="#filter"><code>reject</code></a>: reject跟filter正好相反，当测试为true时则抛弃</li>
<li><a href="#reduce"><code>reduce</code></a>: 可以让我们给定一个初始值，用它与集合中的每一个元素做运算，最后得到一个值。reduce从左向右来遍历元素，如果想从右向左，可使用reduceRight。</li>
<li><a href="#detect"><code>detect</code></a>: 用于取得集合中满足条件的第一个元素。</li>
<li><a href="#sortBy"><code>sortBy</code></a>: 对集合内的元素进行排序，依据每个元素进行某异步操作后产生的值，从小到大排序。</li>
<li><a href="#some"><code>some</code></a>: 当集合中是否有至少一个元素满足条件时，最终callback得到的值为true，否则为false.</li>
<li><a href="#every"><code>every</code></a>: 如果集合里每一个元素都满足条件，则传给最终回调的result为true，否则为false</li>
<li><a href="#concat"><code>concat</code></a>: 将多个异步操作的结果合并为一个数组。</li>
</ul>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="流程控制-Control-Flow" style="display: inline;"><a href="#流程控制-Control-Flow" class="headerlink" title="流程控制: Control Flow"></a>流程控制: <code>Control Flow</code></h3><ul class="g-list-style-circle">
<li><a href="#concat"><code>concat</code></a>: 串行执行，一个函数数组中的每个函数，每一个函数执行完成之后才能执行下一个函数。</li>
<li><a href="#parallel"><code>parallel</code></a>: 并行执行多个函数，每个函数都是立即执行，不需要等待其它函数先执行。传给最终callback的数组中的数据按照tasks中声明的顺序，而不是执行完成的顺序。</li>
<li><a href="#whilst"><code>whilst</code></a>: 相当于while，但其中的异步调用将在完成后才会进行下一次循环。</li>
<li><a href="#whilst"><code>doWhilst</code></a>: 相当于do…while, doWhilst交换了fn,test的参数位置，先执行一次循环，再做test判断。</li>
<li><a href="#whilst"><code>until</code></a>: until与whilst正好相反，当test为false时循环，与true时跳出。其它特性一致。</li>
<li><a href="#whilst"><code>doUntil</code></a>: doUntil与doWhilst正好相反，当test为false时循环，与true时跳出。其它特性一致。</li>
<li><a href="#whilst"><code>forever</code></a>: 无论条件循环执行，如果不出错，callback永远不被执行。</li>
<li><a href="#waterfall"><code>waterfall</code></a>: 按顺序依次执行一组函数。每个函数产生的值，都将传给下一个。</li>
<li><a href="#compose"><code>compose</code></a>: 创建一个包括一组异步函数的函数集合，每个函数会消费上一次函数的返回值。把f(),g(),h()异步函数，组合成f(g(h()))的形式，通过callback得到返回值。</li>
<li><a href="#applyEach"><code>applyEach</code></a>: 实现给一数组中每个函数传相同参数，通过callback返回。如果只传第一个参数，将返回一个函数对象，我可以传参调用。</li>
<li><a href="#queue"><code>queue</code></a>: 是一个串行的消息队列，通过限制了worker数量，不再一次性全部执行。当worker数量不够用时，新加入的任务将会排队等候，直到有新的worker可用。</li>
<li><a href="#cargo"><code>cargo</code></a>: 一个串行的消息队列，类似于queue，通过限制了worker数量，不再一次性全部执行。不同之处在于，cargo每次会加载满额的任务做为任务单元，只有任务单元中全部执行完成后，才会加载新的任务单元。</li>
<li><a href="#auto"><code>auto</code></a>: 用来处理有依赖关系的多个任务的执行。</li>
<li><a href="#iterator"><code>iterator</code></a>: 将一组函数包装成为一个iterator，初次调用此iterator时，会执行定义中的第一个函数并返回第二个函数以供调用。</li>
<li><a href="#apply"><code>apply</code></a>: 可以让我们给一个函数预绑定多个参数并生成一个可直接调用的新函数，简化代码。</li>
<li><a href="#nextTick"><code>nextTick</code></a>: 与nodejs的nextTick一样，再最后调用函数。</li>
<li><a href="#times"><code>times</code></a>: 异步运行,times可以指定调用几次，并把结果合并到数组中返回</li>
<li><a href="#times"><code>timesSeries</code></a>: 与time类似，唯一不同的是同步执行</li>
</ul>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="工具类-Utils" style="display: inline;"><a href="#工具类-Utils" class="headerlink" title="工具类: Utils"></a>工具类: <code>Utils</code></h3><ul class="g-list-style-circle">
<li><a href="#util.js"><code>memoize</code></a>: 让某一个函数在内存中缓存它的计算结果。对于相同的参数，只计算一次，下次就直接拿到之前算好的结果。</li>
<li><a href="#util.js"><code>unmemoize</code></a>: 让已经被缓存的函数，返回不缓存的函数引用。</li>
<li><a href="#util.js"><code>log</code></a>: 执行某异步函数，并记录它的返回值，日志输出。</li>
<li><a href="#util.js"><code>dir</code></a>: 与log类似，不同之处在于，会调用浏览器的console.dir()函数，显示为DOM视图。</li>
<li><a href="#util.js"><code>noConflict</code></a>: 如果之前已经在全局域中定义了async变量，当导入本async.js时，会先把之前的async变量保存起来，然后覆盖它。仅仅用于浏览器端，在nodejs中没用，这里无法演示。</li>
</ul>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H2   </span><h2 id="代码演示" style="display: inline;"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h2><p><a name="apply"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="apply代码演示" style="display: inline;"><a href="#apply代码演示" class="headerlink" title="apply代码演示"></a><code>apply</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * apply是一个非常好用的函数，可以让我们给一个函数预绑定多个参数并生成一个可直接调用的新函数，简化代码。
 *
 * function(callback) { t.inc(3, callback); }
 * 等价于：
 * async.apply(t.inc, 3);
 */</span>
<span class="token comment" spellcheck="true">// apply(function, arguments..)</span>

<span class="token comment" spellcheck="true">/**
 * 通过名字绑定函数t.inc, t.fire，作为新函数给parallel调用
 */</span>
<span class="token comment" spellcheck="true">//1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>inc<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>fire<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//58.605> 1.1 err: null</span>
<span class="token comment" spellcheck="true">//58.613> 1.1 results: [ 4, 100 ]</span>

<span class="token comment" spellcheck="true">/**
 * 构造一个加法函数，通过apply简化代码
 */</span>
<span class="token comment" spellcheck="true">//1.2</span>
<span class="token keyword">function</span> <span class="token function">inc</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>callback<span class="token punctuation">,</span>timeout<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> timeout <span class="token operator">=</span> timeout <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>inc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 inc: '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//58.616> 1.2 inc: 3</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="applyEach"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="applyEach代码演示" style="display: inline;"><a href="#applyEach代码演示" class="headerlink" title="applyEach代码演示"></a><code>applyEach</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
* applyEach，可以实现给一数组中每个函数传相同参数，通过callback返回。
* 如果只传第一个参数，将返回一个函数对象，我可以传参调用。
*/</span>
<span class="token comment" spellcheck="true">// applyEach(fns, args..., callback)</span>

<span class="token comment" spellcheck="true">/**
 * 异步执行，给数组中的函数，他们有相同的参数。
 */</span>
<span class="token comment" spellcheck="true">//1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">applyEach</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.1 handler: "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.1 handler: "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//06.739> 1.1 handler: Hello B</span>
<span class="token comment" spellcheck="true">//07.079> 1.1 handler: Hello A</span>
<span class="token comment" spellcheck="true">//07.080> 1.1 err: null</span>

<span class="token comment" spellcheck="true">/**
 *  异步执行，当只设置第一参数后，得到函数对象，再传参调用这个函数。
 */</span>
<span class="token comment" spellcheck="true">//1.2</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">applyEach</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.2 handler: "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.2 handler: "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">"simgle"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err: '</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//29.351> 1.2 handler: simgle B</span>
<span class="token comment" spellcheck="true">//29.688> 1.2 handler: simgle A</span>

<span class="token comment" spellcheck="true">/**
 *   applyEachSeries与applyEach唯一不同的是，数组的函数同步执行。
 */</span>
<span class="token comment" spellcheck="true">//applyEachSeries(arr, args..., callback)</span>
<span class="token comment" spellcheck="true">//1.3</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">applyEachSeries</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.3 handler: "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.3 handler: "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"aaa"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//10.669> 1.3 handler: aaa A</span>
<span class="token comment" spellcheck="true">//10.831> 1.3 handler: aaa B</span>
<span class="token comment" spellcheck="true">//10.834> 1.3 err: null</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="auto"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="auto代码演示" style="display: inline;"><a href="#auto代码演示" class="headerlink" title="auto代码演示"></a><code>auto</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * auto用来处理有依赖关系的多个任务的执行。
 *
 * 比如某些任务之间彼此独立，可以并行执行；但某些任务依赖于其它某些任务，只能等那些任务完成后才能执行。
 * 虽然我们可以使用parallel和series结合起来实现该功能，但如果任务之间关系复杂，则代码会相当复杂，以后如果想添加一个新任务，也会很麻烦。
 * 这时使用auto，则会事半功倍。
 *
 * 如果有任务中途出错，则会把该错误传给最终callback，所有任务（包括已经执行完的）产生的数据将被忽略。
 * 如果不关心错误和最终数据，可以不用写最后那个callback。
 */</span>
<span class="token comment" spellcheck="true">// async.auto(tasks, [callback])</span>

<span class="token comment" spellcheck="true">/**
 * 我要写一个程序，它要完成以下几件事：
 * 1. 从某处取得数据
 * 2. 在硬盘上建立一个新的目录
 * 3. 将数据写入到目录下某文件
 * 4. 发送邮件，将文件以附件形式发送给其它人。
 *
 * 分析该任务，可以知道1与2可以并行执行，3需要等1和2完成，4要等3完成。
 * 可以按以下方式来使用auto函数。
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">auto</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    getData<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1: got data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'mydata'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    makeFolder<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1: made folder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'myfolder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    writeFile<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'getData'</span><span class="token punctuation">,</span> <span class="token string">'makeFolder'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1: wrote file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'myfile'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    emailFiles<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'writeFile'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1: emailed file: '</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>writeFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>writeFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1: err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1: results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//1.1: made folder</span>
<span class="token comment" spellcheck="true">//1.1: got data</span>
<span class="token comment" spellcheck="true">//1.1: wrote file</span>
<span class="token comment" spellcheck="true">//20.120> 1.1: emailed file: myfile</span>
<span class="token comment" spellcheck="true">//20.125> 1.1: err: null</span>
<span class="token comment" spellcheck="true">//20.127> 1.1: results: { makeFolder: 'myfolder',</span>
<span class="token comment" spellcheck="true">//    getData: 'mydata',</span>
<span class="token comment" spellcheck="true">//    writeFile: 'myfile',</span>
<span class="token comment" spellcheck="true">//    emailFiles: 'myfile' }</span>



<span class="token comment" spellcheck="true">/**
* 如果中途出错，则会把错误交给最终callback，执行完任务的传给最终callback。未执行完成的函数值被忽略
*/</span>
<span class="token comment" spellcheck="true">// 1.2</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">auto</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    getData<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2: got data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'mydata'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    makeFolder<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2: made folder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'myfolder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    writeFile<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'getData'</span><span class="token punctuation">,</span> <span class="token string">'makeFolder'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2: wrote file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    emailFiles<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'writeFile'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2: emailed file: '</span> <span class="token operator">+</span> results<span class="token punctuation">.</span>writeFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'err sending email'</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>writeFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//1.2: made folder</span>
<span class="token comment" spellcheck="true">//1.2: got data</span>
<span class="token comment" spellcheck="true">//1.2: wrote file</span>
<span class="token comment" spellcheck="true">//51.399> 1.2 err: myerr</span>
<span class="token comment" spellcheck="true">//51.401> 1.2 results: { makeFolder: 'myfolder',</span>
<span class="token comment" spellcheck="true">//    getData: 'mydata',</span>
<span class="token comment" spellcheck="true">//    writeFile: undefined }</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="cargo"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="cargo代码演示" style="display: inline;"><a href="#cargo代码演示" class="headerlink" title="cargo代码演示"></a><code>cargo</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * cargo也是一个串行的消息队列，类似于queue，通过限制了worker数量，不再一次性全部执行。
 * 当worker数量不够用时，新加入的任务将会排队等候，直到有新的worker可用。
 *
 * cargo的不同之处在于，cargo每次会加载满额的任务做为任务单元，只有任务单元中全部执行完成后，才会加载新的任务单元。
 */</span>
<span class="token comment" spellcheck="true">// cargo(worker, [payload])</span>

<span class="token comment" spellcheck="true">/**
 * 创建cargo实例
 */</span>
<span class="token keyword">var</span> cargo <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">cargo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>tasks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start '</span> <span class="token operator">+</span> tasks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">/**
 * 监听：如果某次push操作后，任务数将达到或超过worker数量时，将调用该函数
 */</span>
cargo<span class="token punctuation">.</span>saturated <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'all workers to be used'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 监听：当最后一个任务交给worker时，将调用该函数
 */</span>
cargo<span class="token punctuation">.</span>empty <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'no more tasks wating'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 监听：当所有任务都执行完以后，将调用该函数
 */</span>
cargo<span class="token punctuation">.</span>drain <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'all tasks have been processed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 增加新任务
 */</span>
cargo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished processing A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cargo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished processing B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cargo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'C'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished processing C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cargo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'D'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished processing D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cargo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'E'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished processing E'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//40.016> all workers to be used</span>
<span class="token comment" spellcheck="true">//40.020> no more tasks wating</span>
<span class="token comment" spellcheck="true">//40.020> start A</span>
<span class="token comment" spellcheck="true">//40.020> start B</span>
<span class="token comment" spellcheck="true">//40.322> finished processing A</span>
<span class="token comment" spellcheck="true">//40.923> finished processing B</span>
<span class="token comment" spellcheck="true">//40.923> no more tasks wating</span>
<span class="token comment" spellcheck="true">//40.924> start C</span>
<span class="token comment" spellcheck="true">//40.924> start D</span>
<span class="token comment" spellcheck="true">//41.425> finished processing C</span>
<span class="token comment" spellcheck="true">//41.526> finished processing D</span>
<span class="token comment" spellcheck="true">//41.526> no more tasks wating</span>
<span class="token comment" spellcheck="true">//41.527> start E</span>
<span class="token comment" spellcheck="true">//41.728> finished processing E</span>
<span class="token comment" spellcheck="true">//41.728> all tasks have been processed</span>
<span class="token comment" spellcheck="true">//41.729> all tasks have been processed</span>
<span class="token comment" spellcheck="true">//41.729> all tasks have been processed</span>
<span class="token comment" spellcheck="true">//41.729> all tasks have been processed</span>
<span class="token comment" spellcheck="true">//41.730> all tasks have been processed</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="compose"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="compose代码演示" style="display: inline;"><a href="#compose代码演示" class="headerlink" title="compose代码演示"></a><code>compose</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 创建一个包括一组异步函数的函数集合，每个函数会消费上一次函数的返回值。
 * 把f(),g(),h()异步函数，组合成f(g(h()))的形式，通过callback得到返回值。
 */</span>
<span class="token comment" spellcheck="true">// compose(fn1, fn2...)</span>

<span class="token comment" spellcheck="true">/**
 * 通过compose组合，f(g(h()))的形式，从内层到外层的执行的顺序。
 */</span>
<span class="token comment" spellcheck="true">//1.1</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1.f enter: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1.g enter: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1.h enter: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fgh <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>g<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fgh</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//05.307> 1.1.h enter: 4</span>
<span class="token comment" spellcheck="true">//05.329> 1.1.g enter: -6</span>
<span class="token comment" spellcheck="true">//05.341> 1.1.f enter: -12</span>
<span class="token comment" spellcheck="true">//05.361> 1.1 err: null</span>
<span class="token comment" spellcheck="true">//05.362> 1.1 result: -11</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="concat"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="concat代码演示" style="display: inline;"><a href="#concat代码演示" class="headerlink" title="concat代码演示"></a><code>concat</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 将多个异步操作的结果合并为一个数组。
 */</span>
<span class="token comment" spellcheck="true">// concat(arr, iterator(item,callback(err,result)), callback(err,result))</span>

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    aaa<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    bbb<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    ccc<span class="token punctuation">:</span> <span class="token number">66</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'bbb'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'ccc'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 以并行方式对集合中各元素进行异步操作，然后把得到的结果合并为一个数组，传给最后的callback。
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 values: '</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 13.539> 1.1 err:</span>
<span class="token comment" spellcheck="true">// 13.539> 1.1 values: [ 44, 55, 66, 11, 22, 33 ]</span>

<span class="token comment" spellcheck="true">/**
 * 如果中途出错，则把错误以及已经完成的操作的结果交给最后callback。未执行完的则忽略。
 */</span>
<span class="token comment" spellcheck="true">// 1.2</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'ccc'</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 values: '</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 13.439> 1.2 err: myerr</span>
<span class="token comment" spellcheck="true">// 13.439> 1.2 values: [ 44, 55 ]</span>

<span class="token comment" spellcheck="true">/**
 * 按数组中的元素顺序来执行异步操作，一个完成后才对下一个进行操作。所有结果会汇集成一个数组交给最后的callback。
 */</span>
<span class="token comment" spellcheck="true">// concatSeries(arr, iterator, callback)</span>

<span class="token comment" spellcheck="true">// 1.3</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">concatSeries</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 values: '</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 13.859> 1.3 err:</span>
<span class="token comment" spellcheck="true">// 13.859> 1.3 values: [ 11, 22, 33, 44, 55, 66 ]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="detect"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="detect代码演示" style="display: inline;"><a href="#detect代码演示" class="headerlink" title="detect代码演示"></a><code>detect</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 用于取得集合中满足条件的第一个元素。
 * 它分为并行与顺序执行两种方式，分别对应函数detect和detectSeries。
 */</span>
<span class="token comment" spellcheck="true">// detect(array, iterator(item,callback(test)), callback(result)</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>value<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>delay<span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>value<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span>delay<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>value<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span>delay<span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 *  并行执行，通过t.inc做一个累加器，得到第一个满足条件的结果对象
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">detect</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 enter: '</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 handle: '</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>n<span class="token operator">%</span><span class="token number">2</span><span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 09.928> 1.1 enter: 1</span>
<span class="token comment" spellcheck="true">// 09.928> 1.1 enter: 2</span>
<span class="token comment" spellcheck="true">// 09.928> 1.1 enter: 3</span>
<span class="token comment" spellcheck="true">// 10.138> 1.1 handle: 2</span>
<span class="token comment" spellcheck="true">// 10.228> 1.1 handle: 3</span>
<span class="token comment" spellcheck="true">// 10.228> 1.1 result: { value: 3, delay: 300 }</span>
<span class="token comment" spellcheck="true">// 10.438> 1.1 handle: 1</span>
<span class="token comment" spellcheck="true">// 10.438> 1.1 handle: 1</span>

<span class="token comment" spellcheck="true">/**
 *  串行执行，通过t.inc做一个累加器，得到第一个满足条件的结果对象
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">detectSeries</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 enter: '</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 handle: '</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>n<span class="token operator">%</span><span class="token number">2</span><span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 09.928> 1.2 enter: 1</span>
<span class="token comment" spellcheck="true">// 10.438> 1.2 result: { value: 1, delay: 500 }</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="each"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="each代码演示" style="display: inline;"><a href="#each代码演示" class="headerlink" title="each代码演示"></a><code>each</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 如果想对同一个集合中的所有元素都执行同一个异步操作，可以利用each函数。
 *
 * async提供了三种方式：
 * 1. 集合中所有元素并行执行
 * 2. 一个一个顺序执行
 * 3. 分批执行，同一批内并行，批与批之间按顺序
 *
 * 如果中途出错，则错误将上传给最终的callback处理。其它已经启动的任务继续执行，未启动的忽略。
 */</span>
<span class="token comment" spellcheck="true">// each(arr, iterator(item, callback), callback(err))</span>


<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Freewind'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 所有操作并发执行，且全部未出错，最终得到的err为undefined。注意最终callback只有一个参数err。
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 输出如下：</span>
<span class="token comment" spellcheck="true">// 42.244> 1.1 enter: Jack</span>
<span class="token comment" spellcheck="true">// 42.245> 1.1 enter: Mike</span>
<span class="token comment" spellcheck="true">// 42.245> 1.1 enter: Freewind</span>
<span class="token comment" spellcheck="true">// 42.350> 1.1 handle: Mike</span>
<span class="token comment" spellcheck="true">// 42.445> 1.1 handle: Jack</span>
<span class="token comment" spellcheck="true">// 42.554> 1.1 handle: Freewind</span>
<span class="token comment" spellcheck="true">// 42.554> 1.1 err: undefined</span>


<span class="token comment" spellcheck="true">/**
 * 如果中途出错，则出错后马上调用最终的callback。其它未执行完的任务继续执行。
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 enter: '</span> <span class="token operator">+</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'Jack'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 输出如下：</span>
<span class="token comment" spellcheck="true">// 42.246> 1.2 enter: Jack</span>
<span class="token comment" spellcheck="true">// 42.246> 1.2 enter: Mike</span>
<span class="token comment" spellcheck="true">// 42.246> 1.2 enter: Freewind</span>
<span class="token comment" spellcheck="true">// 42.350> 1.2 handle: Mike</span>
<span class="token comment" spellcheck="true">// 42.445> 1.2 handle: Jack</span>
<span class="token comment" spellcheck="true">// 42.446> 1.2 err: myerr</span>
<span class="token comment" spellcheck="true">// 42.555> 1.2 handle: Freewind</span>

<span class="token comment" spellcheck="true">/**
 * 与each相似，但不是并行执行。而是一个个按顺序执行。
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">eachSeries</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 42.247> 1.3 enter: Jack</span>
<span class="token comment" spellcheck="true">// 42.459> 1.3 handle: Jack</span>
<span class="token comment" spellcheck="true">// 42.459> 1.3 enter: Mike</span>
<span class="token comment" spellcheck="true">// 42.569> 1.3 handle: Mike</span>
<span class="token comment" spellcheck="true">// 42.569> 1.3 enter: Freewind</span>
<span class="token comment" spellcheck="true">// 42.883> 1.3 handle: Freewind</span>
<span class="token comment" spellcheck="true">// 42.883> 1.3 err: undefined</span>

<span class="token comment" spellcheck="true">/**
 * 如果中途出错，则马上把错误传给最终的callback，还未执行的不再执行。
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">eachSeries</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 enter: '</span> <span class="token operator">+</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'Jack'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 err: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 42.247> 1.4 enter: Jack</span>
<span class="token comment" spellcheck="true">// 42.460> 1.4 handle: Jack</span>
<span class="token comment" spellcheck="true">// 42.460> 1.4 err: myerr</span>

<span class="token comment" spellcheck="true">/**
 * 分批执行，第二个参数是每一批的个数。每一批内并行执行，但批与批之间按顺序执行。
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">eachLimit</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 err: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 42.247> 1.5 enter: Jack</span>
<span class="token comment" spellcheck="true">// 42.248> 1.5 enter: Mike</span>
<span class="token comment" spellcheck="true">// 42.351> 1.5 handle: Mike</span>
<span class="token comment" spellcheck="true">// 42.352> 1.5 enter: Freewind</span>
<span class="token comment" spellcheck="true">// 42.461> 1.5 handle: Jack</span>
<span class="token comment" spellcheck="true">// 42.664> 1.5 handle: Freewind</span>
<span class="token comment" spellcheck="true">// 42.664> 1.5 err: undefined</span>

<span class="token comment" spellcheck="true">/**
 * 如果中途出错，错误将马上传给最终的callback。同一批中的未执行完的任务还将继续执行，但下一批及以后的不再执行。
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">eachLimit</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.6 enter: '</span> <span class="token operator">+</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.6 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'Jack'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.6 err: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 42.248> 1.6 enter: Jack</span>
<span class="token comment" spellcheck="true">// 42.248> 1.6 enter: Mike</span>
<span class="token comment" spellcheck="true">// 42.352> 1.6 handle: Mike</span>
<span class="token comment" spellcheck="true">// 42.462> 1.6 handle: Jack</span>
<span class="token comment" spellcheck="true">// 42.462> 1.6 err: myerr</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="every"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="every代码演示" style="display: inline;"><a href="#every代码演示" class="headerlink" title="every代码演示"></a><code>every</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 如果集合里每一个元素都满足条件，则传给最终回调的result为true，否则为false
 */</span>
<span class="token comment" spellcheck="true">// every(arr, iterator(item,callback), callback(result))</span>
<span class="token comment" spellcheck="true">//alias: all</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 串行执行，集合中所有的元素都&lt;=10，所以为true
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 enter: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 handle: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 32.113> 1.1 enter: 1</span>
<span class="token comment" spellcheck="true">// 32.123> 1.1 enter: 2</span>
<span class="token comment" spellcheck="true">// 32.123> 1.1 enter: 3</span>
<span class="token comment" spellcheck="true">// 32.123> 1.1 enter: 6</span>
<span class="token comment" spellcheck="true">// 32.233> 1.1 handle: 1</span>
<span class="token comment" spellcheck="true">// 32.233> 1.1 handle: 2</span>
<span class="token comment" spellcheck="true">// 32.233> 1.1 handle: 3</span>
<span class="token comment" spellcheck="true">// 32.233> 1.1 handle: 6</span>
<span class="token comment" spellcheck="true">// 32.233> 1.1 result: true</span>

<span class="token comment" spellcheck="true">/**
 * 串行执行，集合中至少有一个元素不大于2，所以为false
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 enter: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 handle: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 32.123> 1.2 enter: 1</span>
<span class="token comment" spellcheck="true">// 32.123> 1.2 enter: 2</span>
<span class="token comment" spellcheck="true">// 32.123> 1.2 enter: 3</span>
<span class="token comment" spellcheck="true">// 32.123> 1.2 enter: 6</span>
<span class="token comment" spellcheck="true">// 32.233> 1.2 handle: 1</span>
<span class="token comment" spellcheck="true">// 32.233> 1.2 result: false</span>
<span class="token comment" spellcheck="true">// 32.233> 1.2 handle: 2</span>
<span class="token comment" spellcheck="true">// 32.233> 1.2 handle: 3</span>
<span class="token comment" spellcheck="true">// 32.233> 1.2 handle: 6</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="filter"></a><br><br><br><code>filter</code> 和 <code>reject</code>代码演示</p>
<pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 使用异步操作对集合中的元素进行筛选。需要注意的是，iterator的callback只有一个参数，只能接收true或false。
 *
 * 对于出错，该函数没有做出任何处理，直接由nodejs抛出。所以需要注意对Error的处理。
 *
 * async提供了两种方式：
 * 1. 并行执行：filter
 * 2. 顺序执行：filterSereis
 */</span>
<span class="token comment" spellcheck="true">// filter(arr, iterator(item, callback(test)), callback(results))</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 并行执行，对arr进行筛选。
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 test: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">>=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//16.739> 1.1 enter: 1</span>
<span class="token comment" spellcheck="true">//16.749> 1.1 enter: 2</span>
<span class="token comment" spellcheck="true">//16.749> 1.1 enter: 3</span>
<span class="token comment" spellcheck="true">//16.749> 1.1 enter: 4</span>
<span class="token comment" spellcheck="true">//16.749> 1.1 enter: 5</span>
<span class="token comment" spellcheck="true">//16.749> 1.3 enter: 1</span>
<span class="token comment" spellcheck="true">//16.949> 1.1 test: 1</span>
<span class="token comment" spellcheck="true">//16.949> 1.1 test: 2</span>
<span class="token comment" spellcheck="true">//16.949> 1.1 test: 3</span>
<span class="token comment" spellcheck="true">//16.949> 1.1 test: 4</span>
<span class="token comment" spellcheck="true">//16.949> 1.1 test: 5</span>
<span class="token comment" spellcheck="true">//16.949> 1.1 results: [ 3, 4, 5 ]</span>


<span class="token comment" spellcheck="true">/**
* 如果出错，将会由nodejs抛出，导致出错。为保证其它代码正常运行，注释掉该测试。
*
* try..catch：抓不到这个错误
*/</span>
<span class="token comment" spellcheck="true">/*
async.filter(arr, function(item, callback) {
    log('1.2 enter: ' + item);
    setTimeout(function() {
        log('1.2 handle: ' + item);
        if(item===2) {
            throw new Error('myerr');
        }
        callback(item>=3);
    }, 100);
}, function(results) {
    log('1.2 results: ', results);
});
*/</span>

<span class="token comment" spellcheck="true">/**
* 串行执行，对arr进行筛选。
*/</span>
<span class="token comment" spellcheck="true">// 1.3</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">filterSeries</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">>=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 16.749> 1.3 enter: 1</span>
<span class="token comment" spellcheck="true">// 16.949> 1.3 handle: 1</span>
<span class="token comment" spellcheck="true">// 16.949> 1.3 enter: 2</span>
<span class="token comment" spellcheck="true">// 17.149> 1.3 handle: 2</span>
<span class="token comment" spellcheck="true">// 17.149> 1.3 enter: 3</span>
<span class="token comment" spellcheck="true">// 17.369> 1.3 handle: 3</span>
<span class="token comment" spellcheck="true">// 17.369> 1.3 enter: 4</span>
<span class="token comment" spellcheck="true">// 17.589> 1.3 handle: 4</span>
<span class="token comment" spellcheck="true">// 17.589> 1.3 enter: 5</span>
<span class="token comment" spellcheck="true">// 17.789> 1.3 handle: 5</span>
<span class="token comment" spellcheck="true">// 17.789> 1.3 results: [ 3, 4, 5 ]</span>
<span class="token comment" spellcheck="true">/*
* reject跟filter正好相反，当测试为true时，抛弃之
*/</span>
<span class="token comment" spellcheck="true">// reject(arr, iterator(item, callback(test)), callback(results)</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 test: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">>=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 31.359> 1.4 enter: 1</span>
<span class="token comment" spellcheck="true">// 31.359> 1.4 enter: 2</span>
<span class="token comment" spellcheck="true">// 31.359> 1.4 enter: 3</span>
<span class="token comment" spellcheck="true">// 31.359> 1.4 enter: 4</span>
<span class="token comment" spellcheck="true">// 31.359> 1.4 enter: 5</span>
<span class="token comment" spellcheck="true">// 31.559> 1.4 test: 1</span>
<span class="token comment" spellcheck="true">// 31.559> 1.4 test: 2</span>
<span class="token comment" spellcheck="true">// 31.559> 1.4 test: 3</span>
<span class="token comment" spellcheck="true">// 31.559> 1.4 test: 4</span>
<span class="token comment" spellcheck="true">// 31.559> 1.4 test: 5</span>
<span class="token comment" spellcheck="true">// 31.569> 1.4 results: [ 1, 2 ]</span>


<span class="token comment" spellcheck="true">/**
 * 串行执行，对arr进行筛选。
 */</span>
<span class="token comment" spellcheck="true">// 1.3</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">rejectSeries</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">>=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//43.592> 1.5 enter: 1</span>
<span class="token comment" spellcheck="true">//43.799> 1.5 handle: 1</span>
<span class="token comment" spellcheck="true">//43.800> 1.5 enter: 2</span>
<span class="token comment" spellcheck="true">//44.004> 1.5 handle: 2</span>
<span class="token comment" spellcheck="true">//44.007> 1.5 enter: 3</span>
<span class="token comment" spellcheck="true">//44.210> 1.5 handle: 3</span>
<span class="token comment" spellcheck="true">//44.211> 1.5 enter: 4</span>
<span class="token comment" spellcheck="true">//44.412> 1.5 handle: 4</span>
<span class="token comment" spellcheck="true">//44.413> 1.5 enter: 5</span>
<span class="token comment" spellcheck="true">//44.614> 1.5 handle: 5</span>
<span class="token comment" spellcheck="true">//44.616> 1.5 results: [ 1, 2 ]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="iterator"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="iterator代码演示" style="display: inline;"><a href="#iterator代码演示" class="headerlink" title="iterator代码演示"></a><code>iterator</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 将一组函数包装成为一个iterator，初次调用此iterator时，会执行定义中的第一个函数并返回第二个函数以供调用。
 * 也可通过手动调用 next() 得到以下一个函数为起点的新的iterator。
 * 该函数通常由async在内部使用，但如果需要时，也可在我们的代码中使用它。
 */</span>
<span class="token comment" spellcheck="true">// async.iterator(tasks)</span>

<span class="token keyword">var</span> iter <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I am 111'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I am 222'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I am 333'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
* 直接调用()，会执行当前函数，并返回一个由下个函数为起点的新的iterator
*/</span>
<span class="token comment" spellcheck="true">//1.1</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 iter()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it1 <span class="token operator">=</span> <span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//28.368> 1.1 iter()</span>
<span class="token comment" spellcheck="true">//28.371> I am 111</span>
<span class="token comment" spellcheck="true">//28.372> I am 222</span>
<span class="token comment" spellcheck="true">//28.372> I am 222</span>

<span class="token comment" spellcheck="true">/**
* 通过iter()来调用下一个函数
*/</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 iter()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it2 <span class="token operator">=</span> <span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it3 <span class="token operator">=</span> <span class="token function">it2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it4 <span class="token operator">=</span> <span class="token function">it3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//it4(); // 这句代码执行会报错</span>
<span class="token function">log</span><span class="token punctuation">(</span>it4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// => 'null'</span>
<span class="token comment" spellcheck="true">//32.449> 1.2 iter()</span>
<span class="token comment" spellcheck="true">//32.452> I am 111</span>
<span class="token comment" spellcheck="true">//32.452> I am 222</span>
<span class="token comment" spellcheck="true">//32.453> I am 333</span>
<span class="token comment" spellcheck="true">//32.454> null</span>

<span class="token comment" spellcheck="true">/**
 * 调用next()，不会执行当前函数，直接返回由下个函数为起点的新iterator
 * 对于同一个iterator，多次调用next()，不会影响自己
 */</span>
<span class="token comment" spellcheck="true">//1.3</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 iter()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it5 <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it6 <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//39.895> 1.3 iter()</span>
<span class="token comment" spellcheck="true">//39.898> I am 222</span>
<span class="token comment" spellcheck="true">//39.899> I am 333</span>
<span class="token comment" spellcheck="true">//39.899> I am 111</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="map"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="map代码演示" style="display: inline;"><a href="#map代码演示" class="headerlink" title="map代码演示"></a><code>map</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 对集合中的每一个元素，执行某个异步操作，得到结果。所有的结果将汇总到最终的callback里。与each的区别是，each只关心操作不管最后的值，而map关心的最后产生的值。
 *
 * 提供了两种方式：
 * 1. 并行执行。同时对集合中所有元素进行操作，结果汇总到最终callback里。如果出错，则立刻返回错误以及已经执行完的任务的结果，未执行完的占个空位
 * 2. 顺序执行。对集合中的元素一个一个执行操作，结果汇总到最终callback里。如果出错，则立刻返回错误以及已经执行完的结果，未执行的被忽略。
 */</span>
<span class="token comment" spellcheck="true">// map(arr, iterator(item, callback), callback(err, results))</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Freewind'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Test'</span><span class="token punctuation">,</span> delay<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 所有操作均正确执行，未出错。所有结果按元素顺序汇总给最终的callback。
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 54.569> 1.1 enter: Jack</span>
<span class="token comment" spellcheck="true">// 54.569> 1.1 enter: Mike</span>
<span class="token comment" spellcheck="true">// 54.569> 1.1 enter: Freewind</span>
<span class="token comment" spellcheck="true">// 54.569> 1.1 enter: Test</span>
<span class="token comment" spellcheck="true">// 54.629> 1.1 handle: Test</span>
<span class="token comment" spellcheck="true">// 54.679> 1.1 handle: Mike</span>
<span class="token comment" spellcheck="true">// 54.789> 1.1 handle: Jack</span>
<span class="token comment" spellcheck="true">// 54.879> 1.1 handle: Freewind</span>
<span class="token comment" spellcheck="true">// 54.879> 1.1 err:</span>
<span class="token comment" spellcheck="true">// 54.879> 1.1 results: [ 'Jack!!!', 'Mike!!!', 'Freewind!!!', 'Test!!!' ]</span>

<span class="token comment" spellcheck="true">/**
*  如果中途出错，立刻将错误、以及已经执行完成的结果汇总给最终callback。未执行完的将会在结果数组中用占个空位。
*/</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'Jack'</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 54.569> 1.2 enter: Jack</span>
<span class="token comment" spellcheck="true">// 54.569> 1.2 enter: Mike</span>
<span class="token comment" spellcheck="true">// 54.569> 1.2 enter: Freewind</span>
<span class="token comment" spellcheck="true">// 54.569> 1.2 enter: Test</span>
<span class="token comment" spellcheck="true">// 54.629> 1.2 handle: Test</span>
<span class="token comment" spellcheck="true">// 54.679> 1.2 handle: Mike</span>
<span class="token comment" spellcheck="true">// 54.789> 1.2 handle: Jack</span>
<span class="token comment" spellcheck="true">// 54.789> 1.2 err: myerr</span>
<span class="token comment" spellcheck="true">// 54.789> 1.2 results: [ undefined, 'Mike!!!', , 'Test!!!' ]</span>
<span class="token comment" spellcheck="true">// 54.879> 1.2 handle: Freewind</span>

<span class="token comment" spellcheck="true">/**
* 顺序执行，一个完了才执行下一个。
*/</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">mapSeries</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 54.569> 1.3 enter: Jack</span>
<span class="token comment" spellcheck="true">// 54.789> 1.3 handle: Jack</span>
<span class="token comment" spellcheck="true">// 54.789> 1.3 enter: Mike</span>
<span class="token comment" spellcheck="true">// 54.899> 1.3 handle: Mike</span>
<span class="token comment" spellcheck="true">// 54.899> 1.3 enter: Freewind</span>
<span class="token comment" spellcheck="true">// 55.209> 1.3 handle: Freewind</span>
<span class="token comment" spellcheck="true">// 55.209> 1.3 enter: Test</span>
<span class="token comment" spellcheck="true">// 55.269> 1.3 handle: Test</span>
<span class="token comment" spellcheck="true">// 55.269> 1.3 err:</span>
<span class="token comment" spellcheck="true">// 55.269> 1.3 results: [ 'Jack!!!', 'Mike!!!', 'Freewind!!!', 'Test!!!' ]</span>

<span class="token comment" spellcheck="true">/**
* 顺序执行过程中出错，只把错误以及执行完的传给最终callback，未执行的忽略。
*/</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">mapSeries</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'Mike'</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 47.616> 1.4 enter: Jack</span>
<span class="token comment" spellcheck="true">// 47.821> 1.4 handle: Jack</span>
<span class="token comment" spellcheck="true">// 47.821> 1.4 enter: Mike</span>
<span class="token comment" spellcheck="true">// 47.931> 1.4 handle: Mike</span>
<span class="token comment" spellcheck="true">// 47.931> 1.4 err: myerr</span>
<span class="token comment" spellcheck="true">// 47.932> 1.4 results: [ 'Jack!!!', undefined ]</span>

<span class="token comment" spellcheck="true">/**
 * 并行执行，同时最多2个函数并行，传给最终callback。
 */</span>
<span class="token comment" spellcheck="true">//1.5</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">mapLimit</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 enter: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 handle: '</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'Jack'</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//57.797> 1.5 enter: Jack</span>
<span class="token comment" spellcheck="true">//57.800> 1.5 enter: Mike</span>
<span class="token comment" spellcheck="true">//57.900> 1.5 handle: Mike</span>
<span class="token comment" spellcheck="true">//57.900> 1.5 enter: Freewind</span>
<span class="token comment" spellcheck="true">//58.008> 1.5 handle: Jack</span>
<span class="token comment" spellcheck="true">//58.009> 1.5 err: myerr</span>
<span class="token comment" spellcheck="true">//58.009> 1.5 results: [ undefined, 'Mike!!!' ]</span>
<span class="token comment" spellcheck="true">//58.208> 1.5 handle: Freewind</span>
<span class="token comment" spellcheck="true">//58.208> 1.5 enter: Test</span>
<span class="token comment" spellcheck="true">//58.273> 1.5 handle: Test</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="nextTick"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="nextTick代码演示" style="display: inline;"><a href="#nextTick代码演示" class="headerlink" title="nextTick代码演示"></a><code>nextTick</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * nextTick的作用与nodejs的nextTick一样，再最后调用函数。
 * 但在浏览器端，只能使用setTimeout(callback,0)，但这个方法有时候会让其它高优先级的任务插到前面去。
 * 所以提供了这个nextTick，让同样的代码在服务器端和浏览器端表现一致。
 */</span>
<span class="token comment" spellcheck="true">// nextTick(callback)</span>

<span class="token keyword">var</span> calls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    calls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1'</span><span class="token punctuation">,</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
calls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2'</span><span class="token punctuation">,</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3'</span><span class="token punctuation">,</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//09.838> 1.2[ 'one' ]</span>
<span class="token comment" spellcheck="true">//09.842> 1.1[ 'one', 'two' ]</span>
<span class="token comment" spellcheck="true">//09.843> 1.3[ 'one', 'two' ]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="parallel"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="parallel代码演示" style="display: inline;"><a href="#parallel代码演示" class="headerlink" title="parallel代码演示"></a><code>parallel</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 并行执行多个函数，每个函数都是立即执行，不需要等待其它函数先执行。传给最终callback的数组中的数据按照tasks中声明的顺序，而不是执行完成的顺序。
 *
 * 如果某个函数出错，则立刻将err和已经执行完的函数的结果值传给parallel最终的callback。其它未执行完的函数的值不会传到最终数据，但要占个位置。
 * 同时支持json形式的tasks，其最终callback的结果也为json形式。
 */</span>
<span class="token comment" spellcheck="true">// parallel(tasks, [callback])</span>

<span class="token comment" spellcheck="true">/**
 * 并行执行多个函数，每个函数的值将按函数声明的先后顺序汇成一个数组，传给最终callback。
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a400'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a200'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a300'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//36.929> 1.1 err: null</span>
<span class="token comment" spellcheck="true">//36.930> 1.1 results: [ 'a400', 'a200', 'a300' ]</span>

<span class="token comment" spellcheck="true">/**
* 如果中途有个函数出错，则将该err和已经完成的函数值汇成一个数组，传给最终的callback。还没有执行完的函数的值将被忽略，但要在最终数组中占个位置
*/</span>
<span class="token comment" spellcheck="true">// 1.2</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2.1: '</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a400'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 该函数的值不会传给最终callback，但要占个位置</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2.2: '</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span><span class="token string">'e200'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2.3: '</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a100'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//36.537> 1.2.1: start</span>
<span class="token comment" spellcheck="true">//36.540> 1.2.2: start</span>
<span class="token comment" spellcheck="true">//36.541> 1.2.3: start</span>
<span class="token comment" spellcheck="true">//36.741> 1.2 err: e200</span>
<span class="token comment" spellcheck="true">//36.744> 1.2 results: [ , undefined, 'a100' ]</span>

<span class="token comment" spellcheck="true">/**
* 以json形式传入tasks，最终results也为json
*/</span>
<span class="token comment" spellcheck="true">// 1.3</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a400'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'c300'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//36.943> 1.3 err: null</span>
<span class="token comment" spellcheck="true">//36.944> 1.3 results: { b: 'c300', a: 'a400' }</span>

<span class="token comment" spellcheck="true">/**
* 如果中途出错，会将err与已经完成的函数值（汇成一个json）传给最终callback。未执行完成的函数值被忽略，不会出现在最终json中。
*/</span>
<span class="token comment" spellcheck="true">// 1.4</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a400'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 该函数的值不会传给最终的callback</span>
    b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span><span class="token string">'e300'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'c200'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//36.853> 1.4 err: e300</span>
<span class="token comment" spellcheck="true">//36.854> 1.4 results: { c: 'c200', b: undefined }</span>

<span class="token comment" spellcheck="true">/**
 * 并行执行，同时最多2个函数并行，传给最终callback。
 */</span>
<span class="token comment" spellcheck="true">//1.5</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">parallelLimit</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'a400'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'b200'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'c100'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    d<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'d start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'d600'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    e<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'e start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'e300'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//26.993> a start</span>
<span class="token comment" spellcheck="true">//26.996> b start</span>
<span class="token comment" spellcheck="true">//27.200> c start</span>
<span class="token comment" spellcheck="true">//27.202> d start</span>
<span class="token comment" spellcheck="true">//27.313> e start</span>
<span class="token comment" spellcheck="true">//27.809> 1.5 err:</span>
<span class="token comment" spellcheck="true">//27.810> 1.5 results: { a: 'a400', b: 'b200', c: 'c100', e: 'e300', d: 'd600' }</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="queue"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="queue代码演示" style="display: inline;"><a href="#queue代码演示" class="headerlink" title="queue代码演示"></a><code>queue</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * queue是一个串行的消息队列，通过限制了worker数量，不再一次性全部执行。
 * 当worker数量不够用时，新加入的任务将会排队等候，直到有新的worker可用。
 *
 * 该函数有多个点可供回调，如worker用完时、无等候任务时、全部执行完时等。
 */</span>
<span class="token comment" spellcheck="true">// queue(worker, concurrency)</span>

<span class="token comment" spellcheck="true">/**
 * 定义一个queue，设worker数量为2
 */</span>
<span class="token keyword">var</span> q <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'worker is processing task: '</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 监听：如果某次push操作后，任务数将达到或超过worker数量时，将调用该函数
 */</span>
q<span class="token punctuation">.</span>saturated <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'all workers to be used'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 监听：当最后一个任务交给worker时，将调用该函数
 */</span>
q<span class="token punctuation">.</span>empty <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'no more tasks wating'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 监听：当所有任务都执行完以后，将调用该函数
 */</span>
q<span class="token punctuation">.</span>drain <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'all tasks have been processed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
* 独立加入2个任务
*/</span>
q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'t1'</span><span class="token punctuation">,</span> run<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t1 is running, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'t1'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 400ms后执行</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t1 executed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pushed t1, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'t2'</span><span class="token punctuation">,</span>run<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t2 is running, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'t2'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 200ms后执行</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t2 executed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pushed t2, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//54.448> pushed t1, waiting tasks: 1</span>
<span class="token comment" spellcheck="true">//54.451> all workers to be used</span>
<span class="token comment" spellcheck="true">//54.452> pushed t2, waiting tasks: 2</span>
<span class="token comment" spellcheck="true">//54.452> worker is processing task: t1</span>
<span class="token comment" spellcheck="true">//54.453> t1 is running, waiting tasks: 1</span>
<span class="token comment" spellcheck="true">//54.455> no more tasks wating</span>
<span class="token comment" spellcheck="true">//54.455> worker is processing task: t2</span>
<span class="token comment" spellcheck="true">//54.455> t2 is running, waiting tasks: 0</span>
<span class="token comment" spellcheck="true">//54.656> t2 executed</span>
<span class="token comment" spellcheck="true">//54.867> t1 executed</span>
<span class="token comment" spellcheck="true">//54.868> all tasks have been processed</span>


<span class="token comment" spellcheck="true">// 同时加入多个任务</span>
q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'t3'</span><span class="token punctuation">,</span> run<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t3 is running, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'t3'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 300ms后执行</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'t4'</span><span class="token punctuation">,</span> run<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t4 is running, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'t4'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 500ms后执行</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'t5'</span><span class="token punctuation">,</span> run<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t5 is running, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'t5'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 100ms后执行</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'t6'</span><span class="token punctuation">,</span> run<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'t6 is running, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'t6'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 400ms后执行</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err: '</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pushed t3,t4,t5,t6 into queue, waiting tasks: '</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//53.755> all workers to be used</span>
<span class="token comment" spellcheck="true">//53.758> pushed t3,t4,t5,t6 into queue, waiting tasks: 4</span>
<span class="token comment" spellcheck="true">//53.759> worker is processing task: t3</span>
<span class="token comment" spellcheck="true">//53.760> t3 is running, waiting tasks: 3</span>
<span class="token comment" spellcheck="true">//53.762> worker is processing task: t4</span>
<span class="token comment" spellcheck="true">//53.762> t4 is running, waiting tasks: 2</span>
<span class="token comment" spellcheck="true">//54.073> err: null</span>
<span class="token comment" spellcheck="true">//54.074> worker is processing task: t5</span>
<span class="token comment" spellcheck="true">//54.076> t5 is running, waiting tasks: 1</span>
<span class="token comment" spellcheck="true">//54.183> err: null</span>
<span class="token comment" spellcheck="true">//54.184> no more tasks wating</span>
<span class="token comment" spellcheck="true">//54.185> worker is processing task: t6</span>
<span class="token comment" spellcheck="true">//54.186> t6 is running, waiting tasks: 0</span>
<span class="token comment" spellcheck="true">//54.265> err: null</span>
<span class="token comment" spellcheck="true">//54.588> err: null</span>
<span class="token comment" spellcheck="true">//54.589> all tasks have been processed</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="reduce"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="Reduce代码演示" style="display: inline;"><a href="#Reduce代码演示" class="headerlink" title="Reduce代码演示"></a><code>Reduce</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * Reduce可以让我们给定一个初始值，用它与集合中的每一个元素做运算，最后得到一个值。reduce从左向右来遍历元素，如果想从右向左，可使用reduceRight。
 */</span>
<span class="token comment" spellcheck="true">//reduce(arr, memo, iterator(memo,item,callback), callback(err,result))</span>
<span class="token comment" spellcheck="true">//alias: inject, foldl</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 顺序执行
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>memo<span class="token punctuation">,</span> item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 enter: '</span> <span class="token operator">+</span> memo <span class="token operator">+</span><span class="token string">', '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> memo<span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 28.789> 1.1 enter: 100, 1</span>
<span class="token comment" spellcheck="true">// 28.889> 1.1 enter: 101, 3</span>
<span class="token comment" spellcheck="true">// 28.999> 1.1 enter: 104, 5</span>
<span class="token comment" spellcheck="true">// 29.109> 1.1 err:</span>
<span class="token comment" spellcheck="true">// 29.109> 1.1 result: 109</span>

<span class="token comment" spellcheck="true">/**
 * 顺序执行过程中出错，只把错误传给最终callback，结果是null
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>memo<span class="token punctuation">,</span> item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 enter: '</span> <span class="token operator">+</span> memo <span class="token operator">+</span><span class="token string">', '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token operator">===</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> memo<span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 05.541> 1.2 enter: 100, 1</span>
<span class="token comment" spellcheck="true">// 05.649> 1.2 enter: 101, 3</span>
<span class="token comment" spellcheck="true">// 05.760> 1.2 err: myerr</span>
<span class="token comment" spellcheck="true">// 05.760> 1.2 result:</span>

<span class="token comment" spellcheck="true">/**
 * 顺序执行从右向左
 *
 * alias: foldr
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>memo<span class="token punctuation">,</span> item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 enter: '</span> <span class="token operator">+</span> memo <span class="token operator">+</span><span class="token string">', '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> memo<span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 28.789> 1.3 enter: 100, 5</span>
<span class="token comment" spellcheck="true">// 28.889> 1.3 enter: 105, 3</span>
<span class="token comment" spellcheck="true">// 28.999> 1.3 enter: 108, 1</span>
<span class="token comment" spellcheck="true">// 29.109> 1.3 err:</span>
<span class="token comment" spellcheck="true">// 29.109> 1.3 result: 109</span>

<span class="token comment" spellcheck="true">/**
 *  通过t.inc做一个累加器，参与reduce的计算
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>memo<span class="token punctuation">,</span>item<span class="token punctuation">,</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 enter: '</span><span class="token operator">+</span>memo<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 handle: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> memo<span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 28.789> 1.4 enter: 100,1</span>
<span class="token comment" spellcheck="true">// 28.999> 1.4 handle: 2</span>
<span class="token comment" spellcheck="true">// 28.999> 1.4 enter: 102,3</span>
<span class="token comment" spellcheck="true">// 29.209> 1.4 handle: 4</span>
<span class="token comment" spellcheck="true">// 29.209> 1.4 enter: 106,5</span>
<span class="token comment" spellcheck="true">// 29.409> 1.4 handle: 6</span>
<span class="token comment" spellcheck="true">// 29.409> 1.4 err:</span>
<span class="token comment" spellcheck="true">// 29.409> 1.4 result: 112</span>
<span class="token comment" spellcheck="true">// --> spent 0.62s</span>

<span class="token comment" spellcheck="true">/**
 *  通过t.inc做一个累加器，并实现对map的结果集做reduce
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 enter: '</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 handle: '</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> sum <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>memo<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> memo <span class="token operator">+</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 sum: '</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 28.789> 1.5 enter: 1</span>
<span class="token comment" spellcheck="true">// 28.789> 1.5 enter: 3</span>
<span class="token comment" spellcheck="true">// 28.789> 1.5 enter: 5</span>
<span class="token comment" spellcheck="true">// 28.999> 1.5 handle: 2</span>
<span class="token comment" spellcheck="true">// 28.999> 1.5 handle: 4</span>
<span class="token comment" spellcheck="true">// 28.999> 1.5 handle: 6</span>
<span class="token comment" spellcheck="true">// 28.999> 1.5 err:</span>
<span class="token comment" spellcheck="true">// 28.999> 1.5 results: [ 2, 4, 6 ]</span>
<span class="token comment" spellcheck="true">// 28.999> 1.5 sum: 112</span>
<span class="token comment" spellcheck="true">// --> spent 0.21</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="series"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="series代码演示" style="display: inline;"><a href="#series代码演示" class="headerlink" title="series代码演示"></a><code>series</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 串行执行，一个函数数组中的每个函数，每一个函数执行完成之后才能执行下一个函数。
 *
 * 如果任何一个函数向它的回调函数中传了一个error，则后面的函数都不会被执行，并且会立刻将该error以及已经执行了的函数的结果，传给series中最后那个callback。
 * 当所有的函数执行完后（没有出错），则会把每个函数传给其回调函数的结果合并为一个数组，传给series最后的那个callback。
 * 还可以json的形式来提供tasks。每一个属性都会被当作函数来执行，并且结果也会以json形式传给series最后的那个callback。这种方式可读性更高一些。
 */</span>
<span class="token comment" spellcheck="true">// series(tasks, [callback])</span>

<span class="token comment" spellcheck="true">/**
 * 全部函数都正常执行。每个函数产生的值将按顺序合并为一个数组，传给最终的callback。
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//05.155> 1.1 err: null</span>
<span class="token comment" spellcheck="true">//05.156> 1.1 results: [ 4, 9, 3 ]</span>

<span class="token comment" spellcheck="true">/**
 * 中间有函数出错。出错之后的函数不会执行，错误及之前正常执行的函数结果将传给最终的callback。
 */</span>
<span class="token comment" spellcheck="true">// 1.2</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span><span class="token string">'test_err'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//04.964> 1.2 err: test_err</span>
<span class="token comment" spellcheck="true">//04.973> 1.2 results: [ 4, undefined ]</span>

<span class="token comment" spellcheck="true">/**
 * 如果某个函数传的数据是undefined, null, {}, []等，它们会原样传给最终callback。
 */</span>
<span class="token comment" spellcheck="true">// 1.3</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>undefined<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//05.794> 1.3 err: null</span>
<span class="token comment" spellcheck="true">//05.795> 1.3 results: [ 3, undefined, null, {}, [], 'abc' ]</span>

<span class="token comment" spellcheck="true">/**
 * 以json形式传入tasks。其结果也将以json形式传给最终callback。
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>undefined<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    d<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//05.178> 1.4 err: myerr</span>
<span class="token comment" spellcheck="true">//05.179> 1.4 results: { a: 4, b: undefined, c: undefined }</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="some"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="some代码演示" style="display: inline;"><a href="#some代码演示" class="headerlink" title="some代码演示"></a><code>some</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 当集合中是否有至少一个元素满足条件时，最终callback得到的值为true，否则为false.
 */</span>
<span class="token comment" spellcheck="true">// some(arr, iterator(item,callback(test)), callback(result))</span>
<span class="token comment" spellcheck="true">//alias: any</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 串行执行，集合中至少有一个元素&lt;=3，所以结果为true
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 enter: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 handle: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 36.165> 1.1 enter: 1</span>
<span class="token comment" spellcheck="true">// 36.165> 1.1 enter: 2</span>
<span class="token comment" spellcheck="true">// 36.165> 1.1 enter: 3</span>
<span class="token comment" spellcheck="true">// 36.165> 1.1 enter: 6</span>
<span class="token comment" spellcheck="true">// 36.275> 1.1 handle: 1</span>
<span class="token comment" spellcheck="true">// 36.275> 1.1 result: true</span>
<span class="token comment" spellcheck="true">// 36.275> 1.1 handle: 2</span>
<span class="token comment" spellcheck="true">// 36.275> 1.1 handle: 3</span>
<span class="token comment" spellcheck="true">// 36.275> 1.1 handle: 6</span>


<span class="token comment" spellcheck="true">/**
 * 串行执行，集合中没有一个元素>10，所以结果为false
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 enter: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 handle: '</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token operator">></span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 36.165> 1.2 enter: 1</span>
<span class="token comment" spellcheck="true">// 36.165> 1.2 enter: 2</span>
<span class="token comment" spellcheck="true">// 36.165> 1.2 enter: 3</span>
<span class="token comment" spellcheck="true">// 36.165> 1.2 enter: 6</span>
<span class="token comment" spellcheck="true">// 36.275> 1.2 handle: 1</span>
<span class="token comment" spellcheck="true">// 36.275> 1.2 handle: 2</span>
<span class="token comment" spellcheck="true">// 36.275> 1.2 handle: 3</span>
<span class="token comment" spellcheck="true">// 36.275> 1.2 handle: 6</span>
<span class="token comment" spellcheck="true">// 36.275> 1.2 result: false</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="sortBy"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="sortBy代码演示" style="display: inline;"><a href="#sortBy代码演示" class="headerlink" title="sortBy代码演示"></a><code>sortBy</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 对集合内的元素进行排序，依据每个元素进行某异步操作后产生的值，从小到大排序。
 */</span>
<span class="token comment" spellcheck="true">// sortBy(array, iterator(item,callback(err,result)), callback(err,results))</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 通过异步迭代器，对集合进行排序
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">sortBy</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 26.562> 1.1 err: null</span>
<span class="token comment" spellcheck="true">// 26.562> 1.1 results: [ 1, 3, 6 ]</span>

<span class="token comment" spellcheck="true">/**
 * 迭代出错，callback返回err，没有results
 */</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">sortBy</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token operator">===</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 results: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 26.572> 1.2 err: myerr</span>
<span class="token comment" spellcheck="true">// 26.572> 1.2 results:</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="t.js"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="t-js代码演示" style="display: inline;"><a href="#t-js代码演示" class="headerlink" title="t.js代码演示"></a><code>t.js</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token comment" spellcheck="true">// 其实这个文件名的't'我不是很明白原作者freewind的意思，我觉得叫做'lib.js'或者</span>
<span class="token comment" spellcheck="true">// 'helper.js'比较合适，因为这里面都是些辅助函数。</span>

<span class="token keyword">var</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>inc <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//将参数n自增1之后的结果返回给async</span>
    timeout <span class="token operator">=</span> timeout <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>fire <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//直接将obj的内容返回给async</span>
    timeout <span class="token operator">=</span> timeout <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>err <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//模拟一个错误的产生，让async各个函数末尾的callback接收到。</span>
    timeout <span class="token operator">=</span> timeout <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// utils</span>
exports<span class="token punctuation">.</span>log <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//对console.log进行了封装。主要是增加了秒钟的输出，通过秒数的差值方便大家对async的理解。</span>
    process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'ss.SSS'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'> '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token operator">!==</span>undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>wait <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>mils<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//刻意等待mils的时间，mils的单位是毫秒。</span>
    <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token operator">-</span> now <span class="token operator">&lt;=</span> mils<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="times"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="times-timesSeries代码演示" style="display: inline;"><a href="#times-timesSeries代码演示" class="headerlink" title="times timesSeries代码演示"></a><code>times</code> <code>timesSeries</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
* 异步运行,times可以指定调用几次，并把结果合并到数组中返回
*/</span>
<span class="token comment" spellcheck="true">// times(n, callback)</span>

<span class="token keyword">function</span> <span class="token function">delay</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> createUser <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token string">'user'</span> <span class="token operator">+</span> id<span class="token punctuation">,</span>
        delay<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 异步执行，调用3次createUser函数，结果被合并到数组返回
 */</span>
<span class="token comment" spellcheck="true">//1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">times</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.1 enter: "</span><span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 handler: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createUser</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">delay</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 result: '</span><span class="token punctuation">,</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//07.397> 1.1 enter: 0</span>
<span class="token comment" spellcheck="true">//07.400> 1.1 enter: 1</span>
<span class="token comment" spellcheck="true">//07.401> 1.1 enter: 2</span>
<span class="token comment" spellcheck="true">//07.412> 1.1 handler: 2</span>
<span class="token comment" spellcheck="true">//07.912> 1.1 handler: 0</span>
<span class="token comment" spellcheck="true">//08.009> 1.1 handler: 1</span>
<span class="token comment" spellcheck="true">//08.010> 1.1 err: null</span>
<span class="token comment" spellcheck="true">//08.011> 1.1 result: [ { id: 'user0', delay: 500 },</span>
<span class="token comment" spellcheck="true">//    { id: 'user1', delay: 600 },</span>
<span class="token comment" spellcheck="true">//    { id: 'user2', delay: 0 } ]</span>

<span class="token comment" spellcheck="true">/**
*  timesSeries与time唯一不同的是，同步执行
*/</span>
<span class="token comment" spellcheck="true">//timesSeries(n, callback)</span>

<span class="token comment" spellcheck="true">/**
 * 同步执行，调用3次createUser函数，结果被合并到数组返回
 */</span>
<span class="token comment" spellcheck="true">//1.2</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">timesSeries</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.2 enter: "</span><span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 handler: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createUser</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">delay</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 result: '</span><span class="token punctuation">,</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//16.642> 1.2 enter: 0</span>
<span class="token comment" spellcheck="true">//17.159> 1.2 handler: 0</span>
<span class="token comment" spellcheck="true">//17.162> 1.2 enter: 1</span>
<span class="token comment" spellcheck="true">//17.763> 1.2 handler: 1</span>
<span class="token comment" spellcheck="true">//17.767> 1.2 enter: 2</span>
<span class="token comment" spellcheck="true">//17.778> 1.2 handler: 2</span>
<span class="token comment" spellcheck="true">//17.779> 1.2 err: null</span>
<span class="token comment" spellcheck="true">//17.780> 1.2 result: [ { id: 'user0', delay: 500 },</span>
<span class="token comment" spellcheck="true">//    { id: 'user1', delay: 600 },</span>
<span class="token comment" spellcheck="true">//    { id: 'user2', delay: 0 } ]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="util.js"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="unmemoize-noConflict-memoize-log-dir-代码演示" style="display: inline;"><a href="#unmemoize-noConflict-memoize-log-dir-代码演示" class="headerlink" title="unmemoize noConflict memoize log dir 代码演示"></a><code>unmemoize</code> <code>noConflict</code> <code>memoize</code> <code>log</code> <code>dir</code> 代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
* 让某一个函数在内存中缓存它的计算结果。对于相同的参数，只计算一次，下次就直接拿到之前算好的结果。
* hasher可以让我们自定义如何根据参数来判断它是否已经在缓存中了。
*/</span>
<span class="token comment" spellcheck="true">// memoize(fn, [hasher])</span>
<span class="token comment" spellcheck="true">//1.1</span>
<span class="token keyword">var</span> slow_fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 start working for: '</span> <span class="token operator">+</span> x<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 finished: '</span> <span class="token operator">+</span> x<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> x<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">memoize</span><span class="token punctuation">(</span>slow_fn<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.1 first time: "</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'cc'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.1 first time: "</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.1 second time: "</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//15.416> 1.1 start working for: a,b</span>
<span class="token comment" spellcheck="true">//15.920> 1.1 finished: a,b</span>
<span class="token comment" spellcheck="true">//15.920> 1.1 first time: a,b</span>
<span class="token comment" spellcheck="true">//15.921> 1.1 start working for: cc,d</span>
<span class="token comment" spellcheck="true">//16.423> 1.1 finished: cc,d</span>
<span class="token comment" spellcheck="true">//16.423> 1.1 first time: cc,d</span>
<span class="token comment" spellcheck="true">//16.424> 1.1 second time: a,b</span>


<span class="token comment" spellcheck="true">/**
* 让已经被缓存的函数，返回不缓存的函数引用。
*/</span>
<span class="token comment" spellcheck="true">// unmemoize(fn)</span>
<span class="token comment" spellcheck="true">//1.2</span>
<span class="token keyword">var</span> slow_fn2 <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 start working for: '</span> <span class="token operator">+</span> x<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 finished: '</span> <span class="token operator">+</span> x<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> x<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fn2 <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">memoize</span><span class="token punctuation">(</span>slow_fn2<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fn2</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.2 first time: "</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> unFn2 <span class="token operator">=</span><span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">unmemoize</span><span class="token punctuation">(</span>fn2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 unmemoized'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">unFn2</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.2 second time: "</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//16.424> 1.2 start working for: a,b</span>
<span class="token comment" spellcheck="true">//16.926> 1.2 finished: a,b</span>
<span class="token comment" spellcheck="true">//16.926> 1.2 first time: a,b</span>
<span class="token comment" spellcheck="true">//16.927> 1.2 unmemoized</span>
<span class="token comment" spellcheck="true">//16.927> 1.2 start working for: a,b</span>
<span class="token comment" spellcheck="true">//17.428> 1.2 finished: a,b</span>
<span class="token comment" spellcheck="true">//17.428> 1.2 second time: a,b</span>

<span class="token comment" spellcheck="true">/**
* 执行某异步函数，并记录它的返回值。试验函数时很方便，不用写那些固定模式的代码。
* 如果该函数向回调中传入了多个参数，则每行记录一个。
*/</span>
<span class="token comment" spellcheck="true">// log(function, arguments)</span>
<span class="token comment" spellcheck="true">//1.3</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'bsspirit'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">'first '</span> <span class="token operator">+</span> name<span class="token punctuation">,</span>
            <span class="token string">'second '</span><span class="token operator">+</span> name<span class="token punctuation">,</span>
            x<span class="token punctuation">,</span>
            <span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token string">'123'</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.3 handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//37.620> 1.3 handler</span>
<span class="token comment" spellcheck="true">//first time</span>
<span class="token comment" spellcheck="true">//second time</span>
<span class="token comment" spellcheck="true">//[Function]</span>
<span class="token comment" spellcheck="true">//{ a: '123' }</span>

<span class="token comment" spellcheck="true">/**
* dir与log都是打印出输，在nodejs环境中没有分别。
* dir的不同之处在于，会调用浏览器的console.dir()函数，显示为DOM视图。
*
* http://stackoverflow.com/questions/10636866/whats-the-difference-between-async-log-and-async-dir
*/</span>
<span class="token comment" spellcheck="true">//1.4</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.4 handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>hello<span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//37.620> 1.4 handler</span>
<span class="token comment" spellcheck="true">//first time</span>
<span class="token comment" spellcheck="true">//second time</span>
<span class="token comment" spellcheck="true">//[Function]</span>
<span class="token comment" spellcheck="true">//{ a: '123' }</span>

<span class="token comment" spellcheck="true">/**
* noConflict()仅仅用于浏览器端，在nodejs中没用，这里无法演示。
*
* 它的作用是：如果之前已经在全局域中定义了async变量，当导入本async.js时，会先把之前的async变量保存起来，然后覆盖它。
 * 用完之后，调用noConflict()方法，就会归还该值。同时返回async本身供换名使用。
*/</span>
<span class="token comment" spellcheck="true">// noConflict()</span>
<span class="token comment" spellcheck="true">/*
    // global on the server, window in the browser
    var root = this,
        previous_async = root.async;

    if (typeof module !== 'undefined' &amp;&amp; module.exports) {
        module.exports = async;
    }
    else {
        root.async = async;
    }

    async.noConflict = function () {
        root.async = previous_async;
        return async;
    };
*/</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="waterfall"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="waterfall代码演示" style="display: inline;"><a href="#waterfall代码演示" class="headerlink" title="waterfall代码演示"></a><code>waterfall</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 按顺序依次执行一组函数。每个函数产生的值，都将传给下一个。
 * 如果中途出错，后面的函数将不会被执行。错误信息将传给waterfall最终的callback。之前产生的结果被丢弃。
 *
 * 这个函数名为waterfall(瀑布)，可以想像瀑布从上到下，中途冲过一层层突起的石头。
 *
 * 注意，该函数不支持json格式的tasks
 */</span>
<span class="token comment" spellcheck="true">// async.waterfall(tasks, [callback]);</span>

<span class="token comment" spellcheck="true">/**
 * 所有函数正常执行，每个函数的结果都将变为下一个函数的参数。
 *
 * 注意，所有的callback都必须形如callback(err, result)，但err参数在前面各函数中无需声明，它被自动处理。
 */</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1.1: '</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1.2: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1.3: '</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>n<span class="token operator">*</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//31.749> 1.1.1: start</span>
<span class="token comment" spellcheck="true">//31.752> 1.1.2: 3</span>
<span class="token comment" spellcheck="true">//31.953> 1.1.3: 4</span>
<span class="token comment" spellcheck="true">//32.156> 1.1 err: null</span>
<span class="token comment" spellcheck="true">//32.159> 1.1 result: 16</span>

<span class="token comment" spellcheck="true">/**
* 中途有函数出错，其err直接传给最终callback，结果被丢弃，后面的函数不再执行。
*/</span>
<span class="token comment" spellcheck="true">// 1.2</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2.1: '</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2.2: '</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2.3: '</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2.4: '</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//44.935> 1.2.1: start</span>
<span class="token comment" spellcheck="true">//44.939> 1.2.2: 3</span>
<span class="token comment" spellcheck="true">//45.140> 1.2.3: 4</span>
<span class="token comment" spellcheck="true">//45.344> 1.2 err: myerr</span>
<span class="token comment" spellcheck="true">//45.348> 1.2 result:</span>

<span class="token comment" spellcheck="true">/**
* 注意： 以json形式传入tasks，将不会被执行!!
*/</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3.1: '</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3.2: '</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3.3: '</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> t<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>n<span class="token operator">*</span>n<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//49.222> 1.3 err: [Error: First argument to waterfall must be an array of functions]</span>
<span class="token comment" spellcheck="true">//49.228> 1.3 result:</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a name="whilst"></a><br><br></p>
<br><span class="g-font-size-14 g-color-gray-dark-v4">H3   </span><h3 id="whilst-until-doUntil-forever和-doWhilst代码演示" style="display: inline;"><a href="#whilst-until-doUntil-forever和-doWhilst代码演示" class="headerlink" title="whilst until doUntil forever和 doWhilst代码演示"></a><code>whilst</code> <code>until</code> <code>doUntil</code> <code>forever</code>和 <code>doWhilst</code>代码演示</h3><pre class="line-numbers language-javascript g-mb-30"><code class="language-javascript"><span class="token keyword">var</span> <span class="token keyword">async</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> log <span class="token operator">=</span> t<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 相当于while，但其中的异步调用将在完成后才会进行下一次循环。
 *
 * 它相当于：
 * try {
 *   whilst(test) {
 *     fn();
 *   }
 *   callback();
 * } catch (err) {
 *   callback(err);
 * }
 *
 * 该函数的功能比较简单，条件变量通常定义在外面，可供每个函数访问。在循环中，异步调用时产生的值实际上被丢弃了，因为最后那个callback只能传入错误信息。
 *
 * 另外，第二个函数fn需要能接受一个函数cb，这个cb最终必须被执行，用于表示出错或正常结束。
 */</span>
<span class="token comment" spellcheck="true">// whilst(test, fn, callback)</span>

<span class="token comment" spellcheck="true">/**
* 正常情况，没有出错。第二个函数虽然是异步调用，但被同步执行。所以第三个函数被调用时，已经过了3秒。
*/</span>
<span class="token comment" spellcheck="true">// 1.1</span>
<span class="token keyword">var</span> count1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">whilst</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count1 <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 count: '</span><span class="token punctuation">,</span> count1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count1<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 3s have passed</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.1 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//10.318> 1.1 count: 0</span>
<span class="token comment" spellcheck="true">//11.330> 1.1 count: 1</span>
<span class="token comment" spellcheck="true">//12.342> 1.1 count: 2</span>
<span class="token comment" spellcheck="true">//13.356> 1.1 err:</span>


<span class="token comment" spellcheck="true">/**
* 中途出错。出错后立刻调用第三个函数。
*/</span>
<span class="token comment" spellcheck="true">// 1.2</span>
<span class="token keyword">var</span> count2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">whilst</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count2 <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 count: '</span><span class="token punctuation">,</span> count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>count2<span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span><span class="token string">'myerr'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            count2<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 2s have passed</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.2 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//12.805> 1.2 count: 0</span>
<span class="token comment" spellcheck="true">//13.824> 1.2 count: 1</span>
<span class="token comment" spellcheck="true">//14.026> 1.2 err: myerr</span>

<span class="token comment" spellcheck="true">/**
* 第二个函数即使产生值，也会被忽略。第三个函数只能得到err。
*/</span>
<span class="token comment" spellcheck="true">// 1.3</span>
<span class="token keyword">var</span> count3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">whilst</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> count3 <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 count: '</span><span class="token punctuation">,</span> count3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>count3<span class="token operator">++</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// result没有用</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.3 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//45.311> 1.3 count: 0</span>
<span class="token comment" spellcheck="true">//45.514> 1.3 count: 1</span>
<span class="token comment" spellcheck="true">//45.718> 1.3 count: 2</span>
<span class="token comment" spellcheck="true">//45.920> 1.3 err:</span>
<span class="token comment" spellcheck="true">//45.923> 1.3 result:</span>

<span class="token comment" spellcheck="true">/**
*  doWhilst交换了fn,test的参数位置，先执行一次循环，再做test判断。 和javascript中do..while语法一致。
*/</span>
<span class="token comment" spellcheck="true">// doWhilst(fn, test, callback)</span>
<span class="token comment" spellcheck="true">//1.4</span>
<span class="token keyword">var</span> count4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">doWhilst</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 count: '</span><span class="token punctuation">,</span> count4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>count4<span class="token operator">++</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1.4 test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> count4 <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// result没有用</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.4 result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//33.643> 1.4 count: 0</span>
<span class="token comment" spellcheck="true">//33.848> 1.4 test</span>
<span class="token comment" spellcheck="true">//33.850> 1.4 count: 1</span>
<span class="token comment" spellcheck="true">//34.054> 1.4 test</span>
<span class="token comment" spellcheck="true">//34.057> 1.4 count: 2</span>
<span class="token comment" spellcheck="true">//34.269> 1.4 test</span>
<span class="token comment" spellcheck="true">//34.270> 1.4 err:</span>
<span class="token comment" spellcheck="true">//34.270> 1.4 result:</span>

<span class="token comment" spellcheck="true">/**
* until与whilst正好相反，当test为false时循环，与true时跳出。其它特性一致。
*/</span>
<span class="token comment" spellcheck="true">// 1.5</span>
<span class="token keyword">var</span> count5 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">until</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count5<span class="token operator">></span><span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 count: '</span><span class="token punctuation">,</span> count5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count5<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 4s have passed</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.5 err: '</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//42.498> 1.5 count: 0</span>
<span class="token comment" spellcheck="true">//42.701> 1.5 count: 1</span>
<span class="token comment" spellcheck="true">//42.905> 1.5 count: 2</span>
<span class="token comment" spellcheck="true">//43.107> 1.5 count: 3</span>
<span class="token comment" spellcheck="true">//43.313> 1.5 err:</span>

<span class="token comment" spellcheck="true">/**
* doUntil与doWhilst正好相反，当test为false时循环，与true时跳出。其它特性一致。
*/</span>
<span class="token comment" spellcheck="true">// doUntil(fn, test, callback)</span>
<span class="token comment" spellcheck="true">// 1.6</span>
<span class="token keyword">var</span> count6 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">doUntil</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.6 count: '</span><span class="token punctuation">,</span> count6<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count6<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.6 test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> count6<span class="token operator">></span><span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 4s have passed</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.6 err: '</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//41.831> 1.6 count: 0</span>
<span class="token comment" spellcheck="true">//42.035> 1.6 test</span>
<span class="token comment" spellcheck="true">//42.037> 1.6 count: 1</span>
<span class="token comment" spellcheck="true">//42.241> 1.6 test</span>
<span class="token comment" spellcheck="true">//42.244> 1.6 count: 2</span>
<span class="token comment" spellcheck="true">//42.456> 1.6 test</span>
<span class="token comment" spellcheck="true">//42.457> 1.6 count: 3</span>
<span class="token comment" spellcheck="true">//42.660> 1.6 test</span>
<span class="token comment" spellcheck="true">//42.661> 1.6 err:</span>

<span class="token comment" spellcheck="true">/**
 * forever，无论条件循环执行，如果不出错，callback永远不被执行
 */</span>
<span class="token comment" spellcheck="true">//forever(fn, callback)</span>
<span class="token comment" spellcheck="true">//1.7</span>
<span class="token keyword">var</span> count7 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">async</span><span class="token punctuation">.</span><span class="token function">forever</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.7 count: '</span><span class="token punctuation">,</span> count7<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count7<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.7 err: '</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//52.770> 1.7 count: 0</span>
<span class="token comment" spellcheck="true">//52.973> 1.7 count: 1</span>
<span class="token comment" spellcheck="true">//53.175> 1.7 count: 2</span>
<span class="token comment" spellcheck="true">//53.377> 1.7 count: 3</span>
<span class="token comment" spellcheck="true">//53.583> 1.7 count: 4</span>
<span class="token comment" spellcheck="true">//53.785> 1.7 count: 5</span>
<span class="token comment" spellcheck="true">//53.987> 1.7 count: 6</span>
<span class="token comment" spellcheck="true">//54.189> 1.7 count: 7</span>
<span class="token comment" spellcheck="true">//54.391> 1.7 count: 8</span>
<span class="token comment" spellcheck="true">//54.593> 1.7 count: 9</span>
<span class="token comment" spellcheck="true">//54.795> 1.7 count: 10</span>
<span class="token comment" spellcheck="true">//54.997> 1.7 count: 11</span>
<span class="token comment" spellcheck="true">//55.199> 1.7 count: 12</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
    <p hidden id="CurrentFileName">Nodejs Async 学习.md</p>    
          </div>

          <!-- Sources & Tags -->
<div class="g-mb-30">
    <h6 class="g-color-gray-dark-v1 g-mb-15">

        

        

        <strong class="g-mr-5">专栏:</strong> <a class="u-link-v5 g-color-gray-dark-v4 g-color-primary--hover"
                                               href="/categories/服务器/">服务器</a>
        

        

    </h6>
    <h6 class="g-color-gray-dark-v1">
        <strong class="g-mr-5">标签:</strong>

        

        
        <a class="u-tags-v1 g-font-size-12 g-brd-around g-brd-gray-light-v4 g-bg-primary--hover g-brd-primary--hover g-color-black-opacity-0_8 g-color-white--hover rounded g-py-6 g-px-15 g-mr-5"
           href="/tags/nodejs/">nodejs</a>
        
        <a class="u-tags-v1 g-font-size-12 g-brd-around g-brd-gray-light-v4 g-bg-primary--hover g-brd-primary--hover g-color-black-opacity-0_8 g-color-white--hover rounded g-py-6 g-px-15 g-mr-5"
           href="/tags/async/">async</a>
        

        

    </h6>
    <br>

    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <div class="media">
                    <div class="media-body">
                        <span class="g-color-gray-dark-v4 g-font-size-12">本博客采用<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">创作共用保留署名-非商业-禁止演绎4.0国际许可证</a></span>
                        <br>
                        <span class="g-color-gray-dark-v4 g-font-size-12">本文首发于<a
                                    href="http://blog.msiter.com">小酒馆老板</a>的博客<a
                                    href="http://blog.msiter.com">荆文征</a>，版权所有，侵权必究。</span>
                    </div>
                </div>
            </div>
        </div>


            <hr class="g-brd-gray-light-v4">

        </article>

      </div>
      <!-- End Articles Content -->

      <!-- Sidebar -->
      <div class="col-lg-3">

        <div id="stickyblock-start" class="js-sticky-block g-sticky-block--lg g-pt-20" data-start-point="#stickyblock-start" data-end-point="#stickyblock-end" style="top: 0px; width: 255px; height: 957px;">

  

  <div class="g-mb-40">

  <ul class="nav u-nav-v5-1 g-brd-bottom--md g-brd-gray-light-v4" role="tablist" data-target="nav-5-1-default-hor-left-border-bottom" data-tabs-mobile-type="slide-up-down" data-btn-classes="btn btn-md btn-block rounded-0 u-btn-outline-lightgray">
    <li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#nav-5-1-default-hor-left-border-bottom--1" role="tab">目录</a>
    </li>
  </ul>

  <div id="nav-5-1-default-hor-left-border-bottom" class="tab-content g-pt-20">
    <div class="tab-pane fade show active" id="nav-5-1-default-hor-left-border-bottom--1" role="tabpanel">
    <div class="g-mb-40 post-toc">
      <ol class="post-nav"><li class="post-nav-item post-nav-level-2"><a class="post-nav-link" href="#项目简介"><span class="post-nav-number">1.</span> <span class="post-nav-text">项目简介</span></a></li><li class="post-nav-item post-nav-level-2"><a class="post-nav-link" href="#功能简介"><span class="post-nav-number">2.</span> <span class="post-nav-text">功能简介</span></a><ol class="post-nav-child"><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#集合-Collections"><span class="post-nav-number">2.1.</span> <span class="post-nav-text">集合:Collections</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#流程控制-Control-Flow"><span class="post-nav-number">2.2.</span> <span class="post-nav-text">流程控制: Control Flow</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#工具类-Utils"><span class="post-nav-number">2.3.</span> <span class="post-nav-text">工具类: Utils</span></a></li></ol></li><li class="post-nav-item post-nav-level-2"><a class="post-nav-link" href="#代码演示"><span class="post-nav-number">3.</span> <span class="post-nav-text">代码演示</span></a><ol class="post-nav-child"><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#apply代码演示"><span class="post-nav-number">3.1.</span> <span class="post-nav-text">apply代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#applyEach代码演示"><span class="post-nav-number">3.2.</span> <span class="post-nav-text">applyEach代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#auto代码演示"><span class="post-nav-number">3.3.</span> <span class="post-nav-text">auto代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#cargo代码演示"><span class="post-nav-number">3.4.</span> <span class="post-nav-text">cargo代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#compose代码演示"><span class="post-nav-number">3.5.</span> <span class="post-nav-text">compose代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#concat代码演示"><span class="post-nav-number">3.6.</span> <span class="post-nav-text">concat代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#detect代码演示"><span class="post-nav-number">3.7.</span> <span class="post-nav-text">detect代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#each代码演示"><span class="post-nav-number">3.8.</span> <span class="post-nav-text">each代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#every代码演示"><span class="post-nav-number">3.9.</span> <span class="post-nav-text">every代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#iterator代码演示"><span class="post-nav-number">3.10.</span> <span class="post-nav-text">iterator代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#map代码演示"><span class="post-nav-number">3.11.</span> <span class="post-nav-text">map代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#nextTick代码演示"><span class="post-nav-number">3.12.</span> <span class="post-nav-text">nextTick代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#parallel代码演示"><span class="post-nav-number">3.13.</span> <span class="post-nav-text">parallel代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#queue代码演示"><span class="post-nav-number">3.14.</span> <span class="post-nav-text">queue代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#Reduce代码演示"><span class="post-nav-number">3.15.</span> <span class="post-nav-text">Reduce代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#series代码演示"><span class="post-nav-number">3.16.</span> <span class="post-nav-text">series代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#some代码演示"><span class="post-nav-number">3.17.</span> <span class="post-nav-text">some代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#sortBy代码演示"><span class="post-nav-number">3.18.</span> <span class="post-nav-text">sortBy代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#t-js代码演示"><span class="post-nav-number">3.19.</span> <span class="post-nav-text">t.js代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#times-timesSeries代码演示"><span class="post-nav-number">3.20.</span> <span class="post-nav-text">times timesSeries代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#unmemoize-noConflict-memoize-log-dir-代码演示"><span class="post-nav-number">3.21.</span> <span class="post-nav-text">unmemoize noConflict memoize log dir 代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#waterfall代码演示"><span class="post-nav-number">3.22.</span> <span class="post-nav-text">waterfall代码演示</span></a></li><li class="post-nav-item post-nav-level-3"><a class="post-nav-link" href="#whilst-until-doUntil-forever和-doWhilst代码演示"><span class="post-nav-number">3.23.</span> <span class="post-nav-text">whilst until doUntil forever和 doWhilst代码演示</span></a></li></ol></li></ol>
    </div>
    </div>
  </div>

  </div>


<script src="/assets/js/helpers/timeago.min.js" charset="utf-8"></script>
<script type="text/javascript">

  $(document).ready(function() {

    initScrollSpy();

    function initScrollSpy() {
      var tocSelector = '.post-toc';
      var $tocElement = $(tocSelector);
      var activeCurrentSelector = '.active-current';

      $tocElement
        .on('activate.bs.scrollspy', addClassCurrentActiveClass)
        .on('clear.bs.scrollspy', removeCurrentActiveClass);

      $('body').scrollspy({
        target: tocSelector
      });

      function addClassCurrentActiveClass(){
        var $currentActiveElement = $(tocSelector + ' .active').last();
        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');
        $tocElement.scrollTop($currentActiveElement.offset().top - $tocElement.offset().top + $tocElement.scrollTop() - ($tocElement.height() / 2));
      }

      function removeCurrentActiveClass() {
        $(tocSelector + ' ' + activeCurrentSelector)
          .removeClass(activeCurrentSelector.substring(1));
      }
    }

  });

  $(document).ready(function() {
    var html = $('html');
    var hasVelocity = $.isFunction(html.velocity);

    // TOC item animation navigate & prevent #item selector in adress bar.
    $('.post-toc a').on('click', function(e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;

      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });
  });
</script>


<script type="text/javascript">
  function escapeSelector(selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, '\\$&');
  }

  +
  function($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector = (this.options.target || '') + ' .post-nav li > a'
      this.offsets = []
      this.targets = []
      this.activeTarget = null
      this.scrollHeight = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function() {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function() {
      var that = this
      var offsetMethod = 'offset'
      var offsetBase = 0

      this.offsets = []
      this.targets = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function() {
          var $el = $(this)
          var href = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href &&
            $href.length &&
            $href.is(':visible') && [
              [$href[offsetMethod]().top + offsetBase, href]
            ]) || null
        })
        .sort(function(a, b) {
          return a[0] - b[0]
        })
        .each(function() {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function() {
      var scrollTop = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets = this.offsets
      var targets = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy') // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i] &&
          scrollTop >= offsets[i] &&
          (!offsets[i + 1] || scrollTop <= offsets[i + 1]) &&
          this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function(target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function() {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function() {
        var $this = $(this)
        var data = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function() {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function() {
      $('[data-spy="scroll"]').each(function() {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>

<style>
  .post-toc {
    overflow: auto;
  }

  .post-toc ol {
    margin: 0;
    padding: 0 2px 5px 10px;
    text-align: left;
    list-style: none;
    font-size: 14px;
  }

  .post-toc ol>ol {
    padding-left: 0;
  }

  .post-toc ol a {
    transition-duration: 0.2s;
    transition-timing-function: ease-in-out;
    transition-delay: 0s;
    transition-property: all;
    color: #111;
    border-bottom-color: #555;
  }

  .post-toc ol a:hover {
    color: #4f72c1;
    border-bottom-color: #ccc;
  }

  .post-toc .post-nav-item {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.8;
  }

  .post-toc .post-nav .post-nav-child {
    display: none;
  }

  .post-toc .post-nav .active>.post-nav-child {
    display: block;
  }

  .post-toc .post-nav .active-current>.post-nav-child {
    display: block;
  }

  .post-toc .post-nav .active-current>.post-nav-child>.post-nav-item {
    display: block;
  }

  .post-toc .post-nav .active>a {
    color: #6281c8;
    border-bottom-color: #87daff;
  }

  .post-toc .post-nav .active-current>a {
    color: #6281c8;
  }

  .post-toc .post-nav .active-current>a:hover {
    color: #87daff;
  }
</style>

  <!-- News Feed -->
<div class="g-mb-40">

  <!-- Nav tabs -->
  <ul class="nav u-nav-v5-1 g-brd-bottom--md g-brd-gray-light-v4" role="tablist" data-target="nav-5-2-default-hor-left-border-bottom" data-tabs-mobile-type="slide-up-down" data-btn-classes="btn btn-md btn-block rounded-0 u-btn-outline-lightgray">
    <li class="nav-item">
      <a class="nav-link active" data-toggle="tab" href="#nav-5-2-default-hor-left-border-bottom--1" role="tab">最新文章</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#nav-5-2-default-hor-left-border-bottom--2" role="tab">修改历史</a>
    </li>
  </ul>
  <!-- End Nav tabs -->


  <!-- Tab panes -->
  <div id="nav-5-2-default-hor-left-border-bottom" class="tab-content g-pt-20">
    <div class="tab-pane fade show active" id="nav-5-2-default-hor-left-border-bottom--1" role="tabpanel">
      
        <article>
          <h3 class="h6">
            <a class="g-color-gray-dark-v1" href="/Hashimoto IO bound proof of work-20180824.html">Hashimoto I/O bound proof of work</a>
        </h3>
          <span class="g-font-size-12">
            2018/8/24 15:25:0
        </span>
        </article>
        
          <hr class="g-brd-gray-light-v4 g-mt-15 g-mb-10">
          
            
        <article>
          <h3 class="h6">
            <a class="g-color-gray-dark-v1" href="/Practical Byzantine Fault Tolerance-20180803.html">Practical Byzantine Fault Tolerance</a>
        </h3>
          <span class="g-font-size-12">
            2018/8/3 14:22:0
        </span>
        </article>
        
          <hr class="g-brd-gray-light-v4 g-mt-15 g-mb-10">
          
            
        <article>
          <h3 class="h6">
            <a class="g-color-gray-dark-v1" href="/Paxos Made Live - An Engineering Perspective-20180731.html">Paxos Made Live - An Engineering Perspective</a>
        </h3>
          <span class="g-font-size-12">
            2018/7/31 15:5:0
        </span>
        </article>
        
          <hr class="g-brd-gray-light-v4 g-mt-15 g-mb-10">
          
            
        <article>
          <h3 class="h6">
            <a class="g-color-gray-dark-v1" href="/paxos-simple-20180726.html">Paxos Made Simple - Leslie Lamport</a>
        </h3>
          <span class="g-font-size-12">
            2018/7/26 18:22:0
        </span>
        </article>
        
            
    </div>


    <div class="tab-pane fade" id="nav-5-2-default-hor-left-border-bottom--2" role="tabpanel">
      <table id="commit-history-new" style="width:100%">
        <thead><tr><th></th></tr></thead >
        <tbody id="commit-history-new-body">
          <tr><td>
            <li class="media g-brd-around g-brd-gray-light-v4 g-pa-20 g-mb-minus-1">
              <div class="media-body">
                <span class="d-block g-font-size-11 text-center">正在加载...</span>
              </div>
            </li>
          </tr></td>
        </tbody>
        <p class="text-center g-font-size-10" id="history_infomessagelabel"></p>
      </table>
    </div>
  </div>
  <!-- End Tab panes -->


</div>
<!-- End News Feed -->



</div>


      </div>
      <!-- End Sidebar -->
    </div>

    <div class="g-mb-60" id="commit-container">
  <!--PC版-->




</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>

<script type="text/javascript">

var gitalk = new Gitalk({
  clientID: '9fba00e5b04b66d8424e',
  clientSecret: '87d759d3284033b6e5aaac980e63fa74e57fcda7',
  repo: 'aimobier.github.io',
  owner: 'aimobier',
  admin: ['aimobier'],
  id: md5(window.location.pathname),      // Ensure uniqueness and length less than 50
  distractionFreeMode: false  // Facebook-like distraction free mode
})

gitalk.render('commit-container')
	
</script>



  </div>

  <div id="stickyblock-end" style="width: 100%;height: 1px;"></div>
</section>


<script src="/assets/js/components/hs.sticky-block.js"></script>
<script src="/assets/js/githubhistory.js"></script>
<script type="text/javascript">
  // initialization of sticky blocks
  $.HSCore.components.HSStickyBlock.init('.js-sticky-block');
</script>


    
<script type="text/x-mathjax-config">
/// Google  不在翻译 
MathJax.Hub.Queue(function() {
      $("span.MathJax").each(function(){
          $(this).attr("translate","no");
          $(this).addClass("notranslate");
    });
})

</script>




      <!-- JS Implementing Plugins -->
<script src="/assets/vendor/custombox/custombox.min.js"></script>

<!-- JS Unify -->
<script src="/assets/js/components/hs.modal-window.js"></script>


<!-- Footer -->
<footer class="g-bg-black-opacity-0_9 g-color-white-opacity-0_8 ">
  <br><br><br>
  <div class="container g-mb-60">
    <div class="row">

      <!-- Footer Content -->
<div class="col-lg-3 col-md-6 g-mb-40 g-mb-0--lg">
  <div class="u-heading-v2-3--bottom g-brd-white-opacity-0_8 g-mb-20">
    <h2 class="u-heading-v2__title h6 text-uppercase mb-0">关于我</h2>
  </div>

  <div class="g-mb-30">
    <p class="g-color-white-opacity-0_8">努力学习的IOS程序员。目前在学习制作Hexo主题，主要还是为了做自己的一个博客.之后会好好学习linux以及服务器相关的知识.</p>
  </div>

  <address class="mb-0">
    <div class="g-mb-30">
      <h4 class="h6 g-font-weight-600">现居地</h4>
      <p class="mb-0 g-color-white-opacity-0_8">北京 - 国家的首都 </p>
    </div>

    <!-- 配置标签相关视图 -->
    

      <div class="g-mb-30">
        <h4 class="h6 g-font-weight-600">邮箱:</h4>

        

                <p class="mb-0 g-color-white-opacity-0_8">alphabetion@gmail.com</p>
        

                <p class="mb-0 g-color-white-opacity-0_8">jingwenzheng@baimaodai.com</p>
        

      </div>

      



    <div class="mb-0">
      <h4 class="h6 g-font-weight-600">一言:</h4>
      <p class="mb-0">
        <a class="g-color-white-opacity-0_8" id="hitokoto" href="http://hitokoto.cn/">support@htmlstream.com</a>
      </p>
    </div>
  </address>
</div>
<!-- End Footer Content -->


        <!-- Footer Content -->
<div class="col-lg-3 col-md-6 g-mb-40 g-mb-0--lg">


  <!-- 配置标签相关视图 -->
  
    <div class="u-heading-v2-3--bottom g-brd-white-opacity-0_8 g-mb-20">
      <h2 class="u-heading-v2__title h6 text-uppercase mb-0">标签</h2>
    </div>
    <ul class="u-list-inline g-font-size-12 g-mb-30">

      
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/生活/">
            生活
          </a>
        </li>
        
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/悲观/">
            悲观
          </a>
        </li>
        
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/Objective-C/">
            Objective-C
          </a>
        </li>
        
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/AsyncDisplayKit/">
            AsyncDisplayKit
          </a>
        </li>
        
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/ios/">
            ios
          </a>
        </li>
        
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/约束教程/">
            约束教程
          </a>
        </li>
        
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/AttributedString/">
            AttributedString
          </a>
        </li>
        
        <li class="list-inline-item g-mb-10">
          <a class="u-tags-v1 g-brd-around g-brd-white-opacity-0_1 g-bg-primary--hover g-brd-primary--hover g-color-white-opacity-0_8 g-rounded-50 g-py-4 g-px-15" href="/tags/iOS8-html2AttributedString-error/">
            iOS8 html2AttributedString error
          </a>
        </li>
        
    </ul>
    

      <!-- 布局相关链接-->

      <div class="u-heading-v2-3--bottom g-brd-white-opacity-0_8 g-mb-20">
        <h2 class="u-heading-v2__title h6 text-uppercase mb-0">友情链接</h2>
      </div>

      <ul class="list-unstyled">
        

          <li class="g-mb-5">
            <i class="fa fa-angle-right g-mr-5"></i>

            <a class="g-color-white-opacity-0_8" href="https://baidu.com">
              百度
            </a>
          </li>

          

          <li class="g-mb-5">
            <i class="fa fa-angle-right g-mr-5"></i>

            <a class="g-color-white-opacity-0_8" href="https://test.baidu.com">
              测试链接
            </a>
          </li>

          

          <li class="g-mb-5">
            <i class="fa fa-angle-right g-mr-5"></i>

            <a class="g-color-white-opacity-0_8" href="https://baidu.com">
              hexo
            </a>
          </li>

          
      </ul>



</div>
<!-- End Footer Content -->


          <!-- Footer Content -->
<div class="col-lg-3 col-md-6 g-mb-40 g-mb-0--lg">
  <div class="u-heading-v2-3--bottom g-brd-white-opacity-0_8 g-mb-20">
    <h2 class="u-heading-v2__title h6 text-uppercase mb-0">最近文章</h2>
  </div>

  
    

  <article class="media">


  




  <a class="d-flex g-mt-3 mr-3" href="/Hashimoto IO bound proof of work-20180824.html">
    <img class="g-width-60 g-height-60 rounded" src="/publicFiles/images/hashimoto/WX20180824-152143.png" alt="Image Description">
  </a>








    <div class="media-body">
      <h3 class="h6">
            <a class="g-color-white-opacity-0_8 g-color-white--hover" href="/Hashimoto IO bound proof of work-20180824.html">Hashimoto I/O bound proof of work</a>
      </h3>
      <ul class="u-list-inline g-font-size-12">
        <li class="list-inline-item">
          2018/8/24 15:25:0
        </li>
        <li class="list-inline-item">/</li>
        <li class="list-inline-item">
          <a class="u-link-v5 g-color-white-opacity-0_8 g-color-white--hover" href="/Hashimoto IO bound proof of work-20180824.html">
                <i class="fa fa-comments-o"></i>
                <span id = "sourceId::http://blog.msiter.com/Nodejs Async xx-20150706.html" class = "cy_cmt_count" ></span>
              </a>
        </li>
      </ul>
    </div>
  </article>


  <hr class="g-brd-white-opacity-0_1 g-mt-20 g-mb-15">


  

  <article class="media">


  




  <a class="d-flex g-mt-3 mr-3" href="/Practical Byzantine Fault Tolerance-20180803.html">
    <img class="g-width-60 g-height-60 rounded" src="/publicFiles/images/Practical Byzantine Fault Tolerance/WX20180803-120202.png" alt="Image Description">
  </a>








    <div class="media-body">
      <h3 class="h6">
            <a class="g-color-white-opacity-0_8 g-color-white--hover" href="/Practical Byzantine Fault Tolerance-20180803.html">Practical Byzantine Fault Tolerance</a>
      </h3>
      <ul class="u-list-inline g-font-size-12">
        <li class="list-inline-item">
          2018/8/3 14:22:0
        </li>
        <li class="list-inline-item">/</li>
        <li class="list-inline-item">
          <a class="u-link-v5 g-color-white-opacity-0_8 g-color-white--hover" href="/Practical Byzantine Fault Tolerance-20180803.html">
                <i class="fa fa-comments-o"></i>
                <span id = "sourceId::http://blog.msiter.com/Nodejs Async xx-20150706.html" class = "cy_cmt_count" ></span>
              </a>
        </li>
      </ul>
    </div>
  </article>


  <hr class="g-brd-white-opacity-0_1 g-mt-20 g-mb-15">


  

  <article class="media">


  




  <a class="d-flex g-mt-3 mr-3" href="/Paxos Made Live - An Engineering Perspective-20180731.html">
    <img class="g-width-60 g-height-60 rounded" src="/publicFiles/images/Paxos Made Live/WX20180731-101403.png" alt="Image Description">
  </a>








    <div class="media-body">
      <h3 class="h6">
            <a class="g-color-white-opacity-0_8 g-color-white--hover" href="/Paxos Made Live - An Engineering Perspective-20180731.html">Paxos Made Live - An Engineering Perspective</a>
      </h3>
      <ul class="u-list-inline g-font-size-12">
        <li class="list-inline-item">
          2018/7/31 15:5:0
        </li>
        <li class="list-inline-item">/</li>
        <li class="list-inline-item">
          <a class="u-link-v5 g-color-white-opacity-0_8 g-color-white--hover" href="/Paxos Made Live - An Engineering Perspective-20180731.html">
                <i class="fa fa-comments-o"></i>
                <span id = "sourceId::http://blog.msiter.com/Nodejs Async xx-20150706.html" class = "cy_cmt_count" ></span>
              </a>
        </li>
      </ul>
    </div>
  </article>


  <hr class="g-brd-white-opacity-0_1 g-mt-20 g-mb-15">


  

  <article class="media">


  









    <div class="media-body">
      <h3 class="h6">
            <a class="g-color-white-opacity-0_8 g-color-white--hover" href="/paxos-simple-20180726.html">Paxos Made Simple - Leslie Lamport</a>
      </h3>
      <ul class="u-list-inline g-font-size-12">
        <li class="list-inline-item">
          2018/7/26 18:22:0
        </li>
        <li class="list-inline-item">/</li>
        <li class="list-inline-item">
          <a class="u-link-v5 g-color-white-opacity-0_8 g-color-white--hover" href="/paxos-simple-20180726.html">
                <i class="fa fa-comments-o"></i>
                <span id = "sourceId::http://blog.msiter.com/Nodejs Async xx-20150706.html" class = "cy_cmt_count" ></span>
              </a>
        </li>
      </ul>
    </div>
  </article>


  <hr class="g-brd-white-opacity-0_1 g-mt-20 g-mb-15">


  

  <script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cytc1YTze">
  </script>

      
</div>
<!-- End Footer Content -->


            <!-- Footer Content -->
<div class="col-lg-3 col-md-6">
  <div class="u-heading-v2-3--bottom g-brd-white-opacity-0_8 g-mb-20">
    <h2 class="u-heading-v2__title h6 text-uppercase mb-0">订阅</h2>
  </div>

  <div class="g-mb-30">
    <p class="g-color-white-opacity-0_8">订阅我可以更及时的获取到文章的推送，请在下方输入您的邮箱地址获取文章更新</p>
    <div class="input-group border-0 g-rounded-30">
      <input class="form-control border-0 g-rounded-left-30 g-px-12 g-py-8" type="email" placeholder="输入您的邮箱地址">
      <div class="input-group-addon border-0 p-0">
        <button class="btn u-btn-primary g-rounded-right-30 g-px-12 g-py-8" type="submit" role="button">订阅</button>
      </div>
    </div>
  </div>

  <div class="u-heading-v2-3--bottom g-brd-white-opacity-0_8 g-mb-20">
    <h2 class="u-heading-v2__title h6 text-uppercase mb-0">社交</h2>
  </div>

  <p class="g-color-white-opacity-0_8">作为一个宅男，长期宅在家里，会不定期的更新文章。如果你想更新的了解到我的动态，请选择一下任意一种社交方式关注我。</p>
  <ul class="list-inline mb-0">
    <li class="list-inline-item g-mr-10">
      <a class="u-icon-v3 u-icon-size--xs g-bg-white-opacity-0_1 g-bg-white-opacity-0_2--hover g-color-white-opacity-0_6 rounded" href="https://www.facebook.com/aimobier">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li class="list-inline-item g-mr-10">
      <a class="u-icon-v3 u-icon-size--xs g-bg-white-opacity-0_1 g-bg-white-opacity-0_2--hover g-color-white-opacity-0_6 rounded" href="https://www.instagram.com/aimobier/">
        <i class="fa fa-instagram"></i>
      </a>
    </li>
    <li class="list-inline-item g-mr-10">
      <a class="u-icon-v3 u-icon-size--xs g-bg-white-opacity-0_1 g-bg-white-opacity-0_2--hover g-color-white-opacity-0_6 rounded" href="https://github.com/aimobier">
        <i class="fa fa-github"></i>
      </a>
    </li>
    <li class="list-inline-item g-mr-10">
      <a class="u-icon-v3 u-icon-size--xs g-bg-white-opacity-0_1 g-bg-white-opacity-0_2--hover g-color-white-opacity-0_6 rounded" href="http://weibo.com/aouns">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li class="list-inline-item g-mr-10">
      <a class="u-icon-v3 u-icon-size--xs g-bg-white-opacity-0_1 g-bg-white-opacity-0_2--hover g-color-white-opacity-0_6 rounded" href="#modal1" data-modal-target="#modal1" data-modal-effect="fadein">
        <i class="fa fa-weixin"></i>
</a>
    </li>
  </ul>
</div>
<!-- End Footer Content -->

    </div>
  </div>


  <!-- Copyright Footer -->
<div class="g-bg-black-opacity-0_1 g-color-white-opacity-0_8 text-center g-py-20">
  <div class="container">
    
      
        
        <small class="g-font-size-7 g-mr-10 g-mb-10 g-mb-0--md">2015 - 2018 © All Rights Reserved. Msiter by
        <a class="g-color-white-opacity-0_8" href="#">Jing WenZheng</a>
      </small>
  </div>
</div>
<!-- End Copyright Footer -->


</footer>
<!-- End Footer -->
<a class="js-go-to u-go-to-v1" href="#" data-type="fixed" data-position='{
 "bottom": 15,
 "right": 15
}' data-offset-top="400" data-compensation="#js-header" data-show-effect="zoomIn">
  <i class="hs-icon hs-icon-arrow-top"></i>
</a>

<script type="text/javascript">
  $(function() {

    // initialization of go to
    $.HSCore.components.HSGoTo.init('.js-go-to');
    $.HSCore.components.HSModalWindow.init('[data-modal-target]');
    $.getJSON("https://v1.hitokoto.cn/?encode=json", function(json) {

      var author = json["from"];
      var content = json["hitokoto"];

      $("#hitokoto").html(content);

      $("blockquote .content").html(content);
      $("blockquote .author").html(author);
    });
  });
</script>


    </main>

    <div class="u-outer-spaces-helper"></div>


  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
